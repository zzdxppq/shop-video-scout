# Test Design: 3.2 (脚本编辑页面 - Script Editor UI)

2026-01-25 | JW (QA)

## Overview

| Metric | Value |
|--------|-------|
| **Total Scenarios** | 32 |
| **Unit** | 18 (56%) |
| **Integration** | 10 (31%) |
| **E2E** | 4 (13%) |
| **Blind Spot Scenarios** | 12 |

**Priority Distribution**: P0: 6, P1: 16, P2: 8, P3: 2

---

## Scenarios by AC

### AC1: 脚本展示与编辑

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 3.2-UNIT-001 | U | P0 | Script paragraphs render correctly (5-7 segments) | Core display logic, pure component |
| 3.2-UNIT-002 | U | P0 | Shot marker displays section + shot_id format | Pure rendering logic |
| 3.2-UNIT-003 | U | P1 | Click paragraph enables edit mode with textarea | State transition logic |
| 3.2-UNIT-004 | U | P1 | Real-time character count updates on input (BR-1.1) | Pure calculation |
| 3.2-UNIT-005 | U | P1 | Suggested word count = estimatedDuration * 4 (BR-1.2) | Pure calculation |
| 3.2-UNIT-006 | U | P1 | Regenerate button shows remaining count (5 - regenerate_count) (BR-1.3) | Pure calculation |
| 3.2-UNIT-007 | U | P1 | Undo stack pushes state on edit | State management logic |
| 3.2-UNIT-008 | U | P1 | Ctrl+Z / Cmd+Z pops undo stack | Keyboard handler logic |
| 3.2-UNIT-009 | U | P2 | Cancel edit restores original content | State revert logic |
| 3.2-UNIT-010 | U | P2 | Max undo stack depth = 20 | Memory boundary |
| 3.2-INT-001 | I | P0 | GET /api/v1/tasks/{id}/script returns script on page load | API integration |
| 3.2-INT-002 | I | P1 | POST /api/v1/tasks/{id}/regenerate-script updates content | API + state sync |
| 3.2-INT-003 | I | P2 | Regenerate disabled when remaining = 0 | API state + UI |
| 3.2-E2E-001 | E | P1 | Full script viewing flow: load → display → verify content | Critical user journey |

### AC2: 保存脚本修改

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 3.2-UNIT-011 | U | P0 | Save button disabled when no changes (BR-2.4) | Pure state check |
| 3.2-UNIT-012 | U | P1 | Draft saved to localStorage on edit (BR-2.1) | Storage logic |
| 3.2-UNIT-013 | U | P1 | Draft cleared from localStorage on successful save (BR-2.3) | Storage cleanup logic |
| 3.2-UNIT-014 | U | P1 | beforeunload triggers when unsaved changes exist (BR-2.2) | Event handler logic |
| 3.2-UNIT-015 | U | P2 | Validate paragraphs array non-empty | Input validation |
| 3.2-UNIT-016 | U | P2 | Validate paragraph text 1-500 chars | Input validation |
| 3.2-INT-004 | I | P0 | PUT /api/v1/tasks/{id}/script saves successfully | API integration |
| 3.2-INT-005 | I | P1 | Save success shows Toast and updates status to script_edited | State sync |
| 3.2-INT-006 | I | P1 | Save failure (500) shows retry button, preserves local content | Error recovery |
| 3.2-INT-007 | I | P1 | Version conflict (409) prompts page refresh | Conflict handling |
| 3.2-INT-008 | I | P2 | Validation failure (422) highlights error fields | Error feedback |
| 3.2-E2E-002 | E | P0 | Full edit → save flow: edit paragraph → save → verify persistence | Critical user journey |
| 3.2-E2E-003 | E | P1 | Draft recovery flow: edit → close → reopen → verify draft restored | Data recovery journey |

---

## Blind Spot Scenarios [BLIND-SPOT]

| ID | Category | Pri | Scenario | Ref |
|----|----------|-----|----------|-----|
| 3.2-BLIND-BOUNDARY-001 | BOUNDARY | P1 | Empty paragraph text (text = "") | BOUNDARY-001 |
| 3.2-BLIND-BOUNDARY-002 | BOUNDARY | P1 | Paragraph text at max (500 chars) | BOUNDARY-003 |
| 3.2-BLIND-BOUNDARY-003 | BOUNDARY | P1 | Paragraph text exceeds max (501 chars) | BOUNDARY-004 |
| 3.2-BLIND-BOUNDARY-004 | BOUNDARY | P2 | Null/undefined paragraphs array | BOUNDARY-001 |
| 3.2-BLIND-ERROR-001 | ERROR | P1 | API timeout on script load | ERROR-001 |
| 3.2-BLIND-ERROR-002 | ERROR | P1 | Network offline during save (preserve draft) | ERROR-001 |
| 3.2-BLIND-ERROR-003 | ERROR | P2 | Malformed JSON response from API | ERROR-003 |
| 3.2-BLIND-FLOW-001 | FLOW | P1 | Cancel mid-edit (click Cancel button) | FLOW-001 |
| 3.2-BLIND-FLOW-002 | FLOW | P1 | Double-click save button | FLOW-002 |
| 3.2-BLIND-FLOW-003 | FLOW | P1 | Browser back button with unsaved changes (BR-1.4) | FLOW-005 |
| 3.2-BLIND-FLOW-004 | FLOW | P2 | Session expires during edit | FLOW-004 |
| 3.2-BLIND-CONCURRENCY-001 | CONCURRENCY | P1 | Script modified by another user (version conflict) | CONCURRENCY-004 |

---

## Risk Coverage

| Risk | Scenarios Addressing |
|------|----------------------|
| Data loss from unsaved changes | 3.2-UNIT-012, 3.2-UNIT-014, 3.2-BLIND-FLOW-003, 3.2-E2E-003 |
| API failures | 3.2-INT-006, 3.2-INT-007, 3.2-BLIND-ERROR-001, 3.2-BLIND-ERROR-002 |
| Input validation bypass | 3.2-UNIT-015, 3.2-UNIT-016, 3.2-BLIND-BOUNDARY-001/002/003 |
| Version conflicts | 3.2-INT-007, 3.2-BLIND-CONCURRENCY-001 |
| User interruption | 3.2-BLIND-FLOW-001, 3.2-BLIND-FLOW-002, 3.2-BLIND-FLOW-003 |

---

## Execution Order

1. **P0 Unit** (3): 3.2-UNIT-001, 3.2-UNIT-002, 3.2-UNIT-011
2. **P0 Integration** (2): 3.2-INT-001, 3.2-INT-004
3. **P0 E2E** (1): 3.2-E2E-002
4. **P1 Unit** (8): 3.2-UNIT-003 through 3.2-UNIT-008, 3.2-UNIT-012 through 3.2-UNIT-014
5. **P1 Integration** (5): 3.2-INT-002, 3.2-INT-005, 3.2-INT-006, 3.2-INT-007
6. **P1 E2E** (2): 3.2-E2E-001, 3.2-E2E-003
7. **P1 Blind Spot** (8): All P1 BLIND scenarios
8. **P2+ scenarios** (remainder)

---

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 32
  by_level:
    unit: 18
    integration: 10
    e2e: 4
  by_priority:
    p0: 6
    p1: 16
    p2: 8
    p3: 2
  blind_spot_scenarios:
    total: 12
    by_category:
      BOUNDARY: 4
      ERROR: 3
      FLOW: 4
      CONCURRENCY: 1
      DATA: 0
      RESOURCE: 0
  coverage_gaps: []
```

---

## Quality Checklist

**Standard Coverage**:
- [x] Every AC covered (AC1: 14 scenarios, AC2: 13 scenarios)
- [x] Levels appropriate (unit for logic, integration for API, e2e for journeys)
- [x] No duplicate coverage
- [x] Priorities align with risk (data loss/API failures = P0-P1)
- [x] IDs follow convention (3.2-{LEVEL}-{SEQ})
- [x] Scenarios atomic

**Blind Spot Coverage**:
- [x] BOUNDARY scenarios for input fields (4 scenarios)
- [x] ERROR scenarios for external dependencies (3 scenarios)
- [x] FLOW scenarios for multi-step processes (4 scenarios)
- [x] All [BLIND-SPOT] scenarios tagged correctly
