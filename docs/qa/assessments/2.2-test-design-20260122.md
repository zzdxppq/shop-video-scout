# Test Design: 2.2 - 前端视频上传组件

2026-01-22 | JW (QA Engineer)

## Overview

| Metric | Value |
|--------|-------|
| **Total Scenarios** | 26 |
| **Unit Tests** | 8 (31%) |
| **Integration Tests** | 6 (23%) |
| **E2E Tests** | 3 (12%) |
| **Blind Spot Scenarios** | 9 (35%) |

**Priority Distribution:**
- P0: 4
- P1: 14
- P2: 8

## Scenarios by AC

### AC1: 拖拽上传区域

| ID | Lvl | Pri | Test Scenario | Justification |
|----|-----|-----|---------------|---------------|
| 2.2-UNIT-001 | U | P1 | File type validation - accepts video files (mp4, mov) | Pure validation logic |
| 2.2-UNIT-002 | U | P1 | File type validation - rejects non-video files | Pure validation logic |
| 2.2-UNIT-003 | U | P1 | File count validation - within max limit (10-20) | Business rule BR-1.3 |
| 2.2-UNIT-004 | U | P1 | File size validation - within limit (≤100MB) | Architecture constraint |
| 2.2-UNIT-005 | U | P2 | Multiple file handling - correctly processes batch | BR-1.1 batch support |
| 2.2-INT-001 | I | P0 | Presigned URL fetch - successful API call | Critical upload dependency |
| 2.2-INT-002 | I | P0 | File upload to OSS - successful upload with progress tracking | Core feature |
| 2.2-INT-003 | I | P1 | Upload confirmation - POST to confirm upload complete | Data consistency |
| 2.2-INT-004 | I | P1 | Thumbnail display - loads from CDN after upload | User feedback |
| 2.2-E2E-001 | E | P0 | Complete drag-drop upload flow (happy path) | Critical user journey |
| 2.2-E2E-002 | E | P2 | Click-to-upload flow (alternative path) | Alternative input method |

### AC2: 视频列表管理

| ID | Lvl | Pri | Test Scenario | Justification |
|----|-----|-----|---------------|---------------|
| 2.2-UNIT-006 | U | P1 | Video grid rendering - displays thumbnails in grid | UI rendering logic |
| 2.2-UNIT-007 | U | P2 | Duration display - formats seconds to mm:ss | Display formatting |
| 2.2-UNIT-008 | U | P2 | Delete button visibility - shows on hover/tap | UI interaction |
| 2.2-INT-005 | I | P1 | Delete video - successful API call and list refresh | Data mutation |
| 2.2-INT-006 | I | P2 | Load video list - fetches and displays existing videos | Data loading |
| 2.2-E2E-003 | E | P0 | Video list management flow (view, delete, verify removal) | Core user journey |

## Blind Spot Scenarios [BLIND-SPOT]

### BOUNDARY Category

| ID | Pri | Scenario | Input | Expected | Ref |
|----|-----|----------|-------|----------|-----|
| 2.2-BLIND-BOUNDARY-001 | P1 | Empty file drop | Drag with no files | No action, no error | BOUNDARY-001 |
| 2.2-BLIND-BOUNDARY-002 | P1 | Max file count exceeded | >20 files | Reject excess, show warning | BOUNDARY-004 |
| 2.2-BLIND-BOUNDARY-003 | P2 | File size at exact limit | 100MB file | Accept and upload | BOUNDARY-003 |
| 2.2-BLIND-BOUNDARY-004 | P1 | File size exceeds limit | 100MB + 1 byte | Reject with clear message | BOUNDARY-004 |

### FLOW Category

| ID | Pri | Scenario | Trigger | Expected | Ref |
|----|-----|----------|---------|----------|-----|
| 2.2-BLIND-FLOW-001 | P1 | Cancel upload mid-progress | Click cancel at 50% | Upload aborted, file removed from list | FLOW-001 |
| 2.2-BLIND-FLOW-002 | P2 | Browser back during upload | Back button during upload | Confirm dialog or auto-cancel | FLOW-005 |
| 2.2-BLIND-FLOW-003 | P1 | Double-click prevention | Rapid double-click upload | Single upload triggered | FLOW-002 |

### ERROR Category

| ID | Pri | Scenario | Condition | Expected | Ref |
|----|-----|----------|-----------|----------|-----|
| 2.2-BLIND-ERROR-001 | P1 | Network timeout during upload | Network loss mid-upload | Retry option shown, progress preserved | ERROR-001 |
| 2.2-BLIND-ERROR-002 | P2 | Presigned URL API failure | Backend returns 503 | User-friendly error, retry option | ERROR-002 |

## Risk Coverage

| Risk | Mitigated By |
|------|--------------|
| Upload failure loses user progress | 2.2-BLIND-FLOW-001, 2.2-BLIND-ERROR-001 |
| Invalid files uploaded | 2.2-UNIT-001, 2.2-UNIT-002, 2.2-UNIT-004 |
| Duplicate uploads | 2.2-BLIND-FLOW-003 |
| Data loss on delete | 2.2-E2E-003, 2.2-INT-005 |

## Execution Order

1. **P0 Unit Tests** (foundation)
   - None at P0 level

2. **P0 Integration Tests** (critical paths)
   - 2.2-INT-001: Presigned URL fetch
   - 2.2-INT-002: File upload to OSS

3. **P0 E2E Tests** (user journeys)
   - 2.2-E2E-001: Drag-drop upload flow
   - 2.2-E2E-003: Video list management

4. **P1 Tests** (core functionality + blind spots)
   - All P1 unit tests (validation logic)
   - All P1 integration tests (API interactions)
   - All P1 blind spot scenarios

5. **P2+ Tests** (secondary features)
   - Alternative paths and edge cases

## Test Implementation Notes

### Unit Test Setup
- Use Vitest for Vue 3 component testing
- Mock OSS upload APIs
- Use `@vue/test-utils` for component mounting

### Integration Test Setup
- Mock backend API responses (MSW recommended)
- Test presigned URL flow with mock OSS endpoint
- Verify progress event handling

### E2E Test Setup
- Use Playwright/Cypress
- Test with actual file fixtures (small video files)
- Verify visual feedback (drag highlight, progress bar)

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 26
  by_level:
    unit: 8
    integration: 6
    e2e: 3
  by_priority:
    p0: 4
    p1: 14
    p2: 8
  blind_spot_scenarios:
    total: 9
    by_category:
      BOUNDARY: 4
      FLOW: 3
      ERROR: 2
  coverage_gaps: []
  story_type: frontend_ui
  test_design_level: Standard
```
