# Test Design: 1.1 Backend Microservices Infrastructure

**Date:** 2026-01-22 | **QA Engineer:** JW

---

## Overview

| Metric | Value |
|--------|-------|
| **Total Scenarios** | 32 |
| **Unit Tests** | 7 (22%) |
| **Integration Tests** | 15 (47%) |
| **E2E Tests** | 10 (31%) |
| **Priority Distribution** | P0: 10, P1: 14, P2: 6, P3: 2 |
| **Blind Spot Scenarios** | 10 |

---

## Scenarios by AC

### AC1: Spring Cloud项目初始化

| ID | Lvl | Pri | Test Scenario | Justification |
|----|-----|-----|---------------|---------------|
| 1.1-UNIT-001 | U | P0 | Validate parent POM dependencies (Spring Boot 3.x, Spring Cloud 2023.0.x) | BR-1.1 enforcement |
| 1.1-UNIT-002 | U | P1 | Validate common-core module exports (response wrapper, exception handler) | Module contract |
| 1.1-UNIT-003 | U | P1 | Validate common-security module exports (JWT utils) | Module contract |
| 1.1-UNIT-004 | U | P1 | Validate common-mybatis module exports (base entity, config) | Module contract |
| 1.1-INT-001 | I | P0 | All 6 services start successfully | Core functionality |
| 1.1-INT-002 | I | P0 | All services register to Nacos | Service discovery |
| 1.1-INT-003 | I | P0 | Gateway routes to each service correctly | Routing validation |
| 1.1-INT-004 | I | P1 | Gateway CORS configuration works (BR-1.2) | Cross-origin support |
| 1.1-INT-005 | I | P1 | Gateway rate limiting triggers correctly | Traffic control |
| 1.1-INT-006 | I | P2 | Service health check endpoints respond | Observability |
| 1.1-E2E-001 | E | P0 | Full startup: all services → Nacos → Gateway accessible | Critical path |
| 1.1-E2E-002 | E | P1 | Gateway routes external request to internal service | User journey |

### AC2: 数据库和缓存配置

| ID | Lvl | Pri | Test Scenario | Justification |
|----|-----|-----|---------------|---------------|
| 1.1-UNIT-005 | U | P0 | Validate HikariCP max connections = 20 (BR-2.1) | Business rule |
| 1.1-UNIT-006 | U | P0 | Validate Redis JSON serialization config (BR-2.2) | Business rule |
| 1.1-UNIT-007 | U | P1 | Validate MyBatis-Plus configuration | ORM setup |
| 1.1-INT-007 | I | P0 | MySQL connection established successfully | DB connectivity |
| 1.1-INT-008 | I | P0 | Redis connection established successfully | Cache connectivity |
| 1.1-INT-009 | I | P0 | Database schema (users, tasks tables) created correctly | Schema validation |
| 1.1-INT-010 | I | P1 | MyBatis-Plus CRUD operations work | ORM integration |
| 1.1-INT-011 | I | P1 | Redis read/write operations work | Cache integration |
| 1.1-E2E-003 | E | P1 | Service startup blocked on DB connection failure (503) | Error handling |
| 1.1-E2E-004 | E | P2 | Full integration: Service → DB → Redis → Response | Data flow |

---

## Blind Spot Scenarios [BLIND-SPOT]

| ID | Category | Pri | Scenario | Blind Spot Ref |
|----|----------|-----|----------|----------------|
| 1.1-BLIND-BOUNDARY-001 | BOUNDARY | P1 | HikariCP pool exhaustion (21st connection) | BOUNDARY-002 |
| 1.1-BLIND-BOUNDARY-002 | BOUNDARY | P2 | Redis connection pool limits | BOUNDARY-002 |
| 1.1-BLIND-ERROR-001 | ERROR | P0 | Nacos server unavailable at startup | ERROR-002 |
| 1.1-BLIND-ERROR-002 | ERROR | P0 | MySQL server unavailable at startup | ERROR-002 |
| 1.1-BLIND-ERROR-003 | ERROR | P1 | Redis server unavailable at startup | ERROR-002 |
| 1.1-BLIND-ERROR-004 | ERROR | P1 | Invalid Nacos configuration (wrong address) | ERROR-001 |
| 1.1-BLIND-ERROR-005 | ERROR | P2 | Invalid DB credentials | ERROR-001 |
| 1.1-BLIND-CONCURRENCY-001 | CONCURRENCY | P1 | Multiple services registering to Nacos simultaneously | CONCURRENCY-001 |
| 1.1-BLIND-DATA-001 | DATA | P1 | SQL migration scripts idempotent (re-runnable) | DATA-002 |
| 1.1-BLIND-RESOURCE-001 | RESOURCE | P2 | Service graceful shutdown (connection cleanup) | RESOURCE-002 |

---

## Risk Coverage

| Risk | Mitigating Scenarios |
|------|----------------------|
| Service startup failures | 1.1-INT-001, 1.1-E2E-001, 1.1-BLIND-ERROR-001/002/003 |
| Service discovery issues | 1.1-INT-002, 1.1-BLIND-CONCURRENCY-001 |
| Database connectivity | 1.1-INT-007, 1.1-INT-009, 1.1-BLIND-ERROR-002/005 |
| Cache connectivity | 1.1-INT-008, 1.1-INT-011, 1.1-BLIND-ERROR-003 |
| Gateway routing failures | 1.1-INT-003, 1.1-E2E-002 |
| Business rule violations | 1.1-UNIT-001, 1.1-UNIT-005, 1.1-UNIT-006 |

---

## Execution Order

1. **P0 Unit** (3 scenarios): Configuration validation
2. **P0 Integration** (5 scenarios): Core connectivity
3. **P0 E2E** (1 scenario): Critical startup path
4. **P0 Blind Spot** (2 scenarios): Critical error handling
5. **P1 Unit + Integration** (9 scenarios): Feature completeness
6. **P1 Blind Spot** (5 scenarios): Edge case coverage
7. **P2+ scenarios**: As time permits

---

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 32
  by_level:
    unit: 7
    integration: 15
    e2e: 10
  by_priority:
    p0: 10
    p1: 14
    p2: 6
    p3: 2
  blind_spot_scenarios:
    total: 10
    by_category:
      BOUNDARY: 2
      ERROR: 5
      CONCURRENCY: 1
      DATA: 1
      RESOURCE: 1
  coverage_gaps: []
  design_date: "2026-01-22"
  designed_by: "JW"
```

---

## Trace References

- Test Design: `docs/qa/assessments/1.1-test-design-20260122.md`
- Story: `docs/stories/1.1.backend-microservices.md`
- Architecture: `docs/architecture.md - Section 3.1, 4.1`
