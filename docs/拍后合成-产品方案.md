# 探店宝 - 拍后合成版 产品方案

> 定位：探店达人的AI视频助手，自动筛选优质镜头、生成口播脚本、配音合成成品视频

---

## 一、产品概述

### 1.1 核心价值主张

**"上传素材，AI帮你挑镜头、写文案、配音剪辑，一键出片"**

| 用户痛点 | 解决方案 |
|----------|----------|
| 拍了十几条素材，挑选费时 | AI自动识别优质镜头并分类 |
| 每次都要绞尽脑汁写口播文案 | 基于镜头内容+店铺信息自动生成 |
| 不知道哪个镜头该配什么话 | AI为每个镜头匹配对应文案 |
| 配音剪辑太麻烦 | **AI自动配音+视频合成，直接出成品** |

### 1.2 MVP范围（V1.0 Web版）

| 功能 | 状态 | 说明 |
|------|------|------|
| 视频批量上传 | ✅ MVP | 支持10-20个短视频 |
| 店铺信息输入 | ✅ MVP | 名称+类型+优惠描述 |
| AI镜头分析 | ✅ MVP | 通义千问VL - 内容识别+质量评分+分类 |
| AI脚本生成 | ✅ MVP | 豆包API - 基于镜头生成口播文案 |
| AI配音合成 | ✅ MVP | 阿里云语音合成 - 标准音色+声音克隆 |
| 声音克隆 | ✅ MVP | 支持用户上传声音样本克隆自己的声音 |
| 视频自动剪辑 | ✅ MVP | FFmpeg自动拼接推荐镜头 |
| 预览播放 | ✅ MVP | 在线预览合成效果 |
| 导出成品 | ✅ MVP | 下载完整MP4视频 |
| 热门话题推荐 | ✅ MVP | AI推荐抖音热门话题标签 |
| 标题建议 | ✅ MVP | AI生成3-5个视频标题供选择 |

### 1.3 版本规划

| 版本 | 定位 | 核心功能 |
|------|------|----------|
| **V1.0** | Web MVP | 完整流程：上传→分析→脚本→配音→剪辑→导出 |
| V1.x | Web优化 | 多音色、剪辑模板、批量任务、用户反馈优化 |
| **V2.0** | iOS App | 移动端体验、会员订阅、Apple Pay支付 |

---

## 二、用户流程设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           用户操作流程 (V1.0)                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐
│  │ Step 1 │──▶│ Step 2 │──▶│ Step 3 │──▶│ Step 4 │──▶│ Step 5 │──▶│ Step 6 │
│  │填写信息│   │上传视频│   │AI分析  │   │生成脚本│   │配音合成│   │预览导出│
│  └────────┘   └────────┘   └────────┘   └────────┘   └────────┘   └────────┘
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 1: 填写店铺信息                                               │ │
│  │ • 店铺名称（必填）                                                 │ │
│  │ • 店铺类型：餐饮/美容/休闲娱乐/其他                                 │ │
│  │ • 商品/优惠描述（选填，如"人均89，必点招牌烤鱼"）                   │ │
│  │ • 视频风格：种草型/测评型/探店vlog                                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 2: 批量上传视频                                               │ │
│  │ • 支持拖拽上传                                                     │ │
│  │ • 支持选择多个文件（限制10-20个）                                   │ │
│  │ • 显示上传进度                                                     │ │
│  │ • 单个视频限制：< 100MB，< 3分钟                                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 3: AI镜头分析                                                 │ │
│  │ • 进度条显示分析进度                                               │ │
│  │ • 识别镜头内容并分类（食物/人物/环境/其他）                         │ │
│  │ • 评估画面质量并评分                                               │ │
│  │ • 标记推荐镜头（每类Top2）                                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 4: AI生成脚本                                                 │ │
│  │ • 基于镜头内容+店铺信息生成口播文案                                 │ │
│  │ • 分段落，每段对应具体镜头                                         │ │
│  │ • 支持手动编辑修改脚本                                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 5: AI配音 & 视频合成                                          │ │
│  │ • 选择配音音色：                                                   │ │
│  │   - 标准音色（2-3种可选：活泼女声/阳光男声/知性女声）              │ │
│  │   - 我的声音（用户克隆的声音，需先上传样本）                       │ │
│  │ • 声音克隆：上传30秒-2分钟声音样本，AI克隆用户声音                 │ │
│  │ • TTS将脚本转为配音音频                                            │ │
│  │ • 根据配音时长裁剪视频片段                                         │ │
│  │ • 自动合并视频+配音生成成品                                        │ │
│  │ • 进度显示（预计5-8分钟）                                          │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 6: 预览 & 导出成品                                            │ │
│  │ • 在线视频播放器预览合成效果                                       │ │
│  │ • 不满意可返回修改脚本重新生成                                     │ │
│  │ • 一键下载成品MP4视频                                              │ │
│  │ • 可选下载推荐镜头素材包                                           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ Step 7: 发布辅助 (热门话题 & 标题推荐)                              │ │
│  │ • AI推荐5-10个抖音热门话题标签                                     │ │
│  │ • AI生成3-5个吸引眼球的视频标题                                    │ │
│  │ • 一键复制话题标签或标题                                           │ │
│  │ • 标签格式符合抖音/小红书规范                                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 三、页面结构设计

### 3.1 页面清单

```
/                        # 首页/落地页
/create                  # 创建任务（Step 1-2）
/task/:id                # 任务详情页（Step 3-6）
/task/:id/result         # 结果预览&导出页
/history                 # 历史任务列表
/login                   # 登录页
/pricing                 # 定价页
```

### 3.2 核心页面原型

#### 页面1: 创建任务页 `/create`

```
┌─────────────────────────────────────────────────────────────┐
│  🎬 探店宝                                    [历史记录] [登录] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                    店铺信息                            │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 店铺名称 *                                       │ │ │
│  │  │ ┌─────────────────────────────────────────────┐ │ │ │
│  │  │ │ 例如：海底捞火锅(望京店)                      │ │ │ │
│  │  │ └─────────────────────────────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                       │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 店铺类型 *                                       │ │ │
│  │  │ ○ 餐饮美食  ○ 美容美发  ○ 休闲娱乐  ○ 其他      │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                       │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 商品/优惠描述（选填）                            │ │ │
│  │  │ ┌─────────────────────────────────────────────┐ │ │ │
│  │  │ │ 例如：人均89，必点招牌烤鱼，现在团购立减30   │ │ │ │
│  │  │ └─────────────────────────────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                       │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 视频风格 *                                       │ │ │
│  │  │ ○ 种草安利型  ○ 真实测评型  ○ 探店vlog型        │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                    上传视频素材                        │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │                                                 │ │ │
│  │  │     ┌─────────────────────────────────────┐    │ │ │
│  │  │     │                                     │    │ │ │
│  │  │     │    📁 点击或拖拽上传视频素材         │    │ │ │
│  │  │     │                                     │    │ │ │
│  │  │     │    支持 MP4/MOV，单个<100MB         │    │ │ │
│  │  │     │    可上传 10-20 个视频              │    │ │ │
│  │  │     │                                     │    │ │ │
│  │  │     └─────────────────────────────────────┘    │ │ │
│  │  │                                                 │ │ │
│  │  │  已上传 3/20:                                   │ │ │
│  │  │  ┌────┐ ┌────┐ ┌────┐                         │ │ │
│  │  │  │ 🎬 │ │ 🎬 │ │ 🎬 │  ···                    │ │ │
│  │  │  │ ✓  │ │ ✓  │ │ 78%│                         │ │ │
│  │  │  └────┘ └────┘ └────┘                         │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│              ┌─────────────────────────────┐                │
│              │     🚀 开始AI分析            │                │
│              └─────────────────────────────┘                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 页面2: 任务处理页 `/task/:id` (分析+脚本+配音合成)

```
┌─────────────────────────────────────────────────────────────┐
│  🎬 探店宝                                    [历史记录] [登录] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  海底捞火锅(望京店)                              2026-01-14  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  📊 处理进度                                           │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  ✅ 视频上传完成                                        │
│  │  ✅ AI镜头分析完成                                      │
│  │  ✅ AI脚本生成完成                                      │
│  │  🔄 AI配音合成中... (3/5)                              │
│  │  ○ 视频剪辑合成                                        │
│  │                                                         │
│  │  ████████████████░░░░░░░░ 65%                          │
│  │  预计剩余时间: 约3分钟                                  │
│  │                                                         │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  📝 AI生成口播脚本                           [编辑脚本]  │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  【开场】(对应镜头: 达人出镜#1)                          │
│  │  "家人们！今天给你们探一家望京超火的海底捞，             │
│  │   据说他们家的服务能让你感动到哭！"                      │
│  │                                                         │
│  │  【环境展示】(对应镜头: 环境#1)                          │
│  │  "一进门就被这个装修惊艳到了，满满的中国风，             │
│  │   拍照也太出片了吧！"                                   │
│  │                                                         │
│  │  【菜品介绍】(对应镜头: 食物#1, #2)                      │
│  │  "必点这个招牌毛肚，七上八下涮出来，                    │
│  │   口感脆嫩，蘸上他们家秘制酱料，绝了！"                 │
│  │                                                         │
│  │  【优惠信息】(对应镜头: 食物#3)                          │
│  │  "现在团购人均才89，比平时便宜30块！                    │
│  │   链接放评论区了，冲！"                                 │
│  │                                                         │
│  │  【结尾】(对应镜头: 达人出镜#2)                          │
│  │  "喜欢的宝子点个关注，下期带你们探更多宝藏店！"         │
│  │                                                         │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  🎤 配音设置                                           │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  选择音色:                                              │
│  │  ┌─────────────────────────────────────────────────┐   │
│  │  │ 标准音色                                         │   │
│  │  │ ● 小美(活泼女声) ○ 小帅(阳光男声) ○ 小雅(知性)   │   │
│  │  └─────────────────────────────────────────────────┘   │
│  │  ┌─────────────────────────────────────────────────┐   │
│  │  │ 我的声音                               [上传样本]  │   │
│  │  │ ○ 我的声音 (已克隆)                    [试听]      │   │
│  │  │                                                   │   │
│  │  │ 💡 首次使用需上传30秒-2分钟声音样本               │   │
│  │  └─────────────────────────────────────────────────┘   │
│  │                                                         │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 页面3: 结果预览&导出页 `/task/:id/result`

```
┌─────────────────────────────────────────────────────────────┐
│  🎬 探店宝                                    [历史记录] [登录] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  海底捞火锅(望京店) - 成品预览                   2026-01-14  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                                                         │ │
│  │  ┌─────────────────────────────────────────────────┐   │ │
│  │  │                                                 │   │ │
│  │  │                                                 │   │ │
│  │  │              🎬 视频预览播放器                   │   │ │
│  │  │                                                 │   │ │
│  │  │                    ▶️                           │   │ │
│  │  │                                                 │   │ │
│  │  │                                                 │   │ │
│  │  ├─────────────────────────────────────────────────┤   │ │
│  │  │  ▶️  ████████░░░░░░░░░░░░  00:35 / 01:02       │   │ │
│  │  └─────────────────────────────────────────────────┘   │ │
│  │                                                         │ │
│  │  视频信息: 1080p | 01:02 | 45.6MB                      │ │
│  │                                                         │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  📊 使用的镜头                                展开查看  │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐                   │ │
│  │  │达人│ │环境│ │食物│ │食物│ │达人│                   │ │
│  │  │#1 │ │#1 │ │#1 │ │#2 │ │#2 │                   │ │
│  │  │8s │ │6s │ │12s│ │10s│ │6s │                   │ │
│  │  └────┘ └────┘ └────┘ └────┘ └────┘                   │ │
│  │                                                         │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │   📥 下载成品    │  │  ✏️ 修改脚本重做 │  │ 📦 下载素材包│ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  🔥 推荐热门话题标签                         [一键复制]  │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  #海底捞 #火锅探店 #望京美食 #必吃榜 #美食推荐          │
│  │  #吃货日常 #探店达人 #北京美食 #团购优惠 #周末去哪吃    │
│  │                                                         │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  📝 推荐视频标题                                        │ │
│  │  ─────────────────────────────────────────────────────  │
│  │                                                         │
│  │  ○ "望京这家海底捞太绝了！服务好到让你感动流泪"    [复制]│
│  │  ○ "人均89吃海底捞？这个团购也太香了吧！"          [复制]│
│  │  ○ "海底捞探店｜必点招牌毛肚，七上八下太嫩了"      [复制]│
│  │  ○ "朋友聚餐首选！望京海底捞氛围感拉满"            [复制]│
│  │                                                         │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │  💡 温馨提示                                           │ │
│  │  • 视频已优化为抖音/小红书竖屏格式                      │ │
│  │  • 话题标签已根据内容智能匹配热门趋势                   │ │
│  │  • 素材包包含所有推荐镜头原片，可自行二次创作           │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 四、技术架构设计

### 4.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        客户端                                    │
│  ┌─────────────────────┐        ┌─────────────────────┐        │
│  │   Web Client        │        │   iOS App (V2.0)    │        │
│  │   (Vue 3 + Vite)    │        │   (预留)            │        │
│  └──────────┬──────────┘        └──────────┬──────────┘        │
└─────────────┼──────────────────────────────┼────────────────────┘
              │ HTTPS                        │ HTTPS
              └──────────────┬───────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Nginx + API Gateway                          │
│              (Spring Cloud Gateway + Nacos)                      │
│  • SSL终止  • 路由分发  • 限流熔断  • 统一认证                    │
└───────────────────────────────┬─────────────────────────────────┘
                                │
     ┌──────────────┬───────────┼───────────┬──────────────┐
     ▼              ▼           ▼           ▼              ▼
┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│用户服务  │ │任务服务  │ │AI分析服务│ │媒体处理  │ │发布辅助  │
│user-svc  │ │task-svc  │ │ai-svc    │ │media-svc │ │publish   │
│          │ │          │ │          │ │          │ │          │
│• 认证    │ │• 任务CRUD│ │• 镜头分析│ │• TTS配音 │ │• 话题推荐│
│• 会员    │ │• 进度    │ │• 脚本生成│ │• 声音克隆│ │• 标题生成│
│• 声音样本│ │• 结果    │ │• 评估    │ │• 视频合成│ │          │
└────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘
     │            │            │            │            │
     └────────────┴────────────┴────────────┴────────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ▼                      ▼                      ▼
 ┌─────────────┐       ┌─────────────┐       ┌─────────────┐
 │   MySQL     │       │   Redis     │       │ 阿里云OSS   │
 │  (主从复制) │       │   Cluster   │       │   + CDN     │
 │  • 业务数据 │       │  • 缓存     │       │  • 视频存储 │
 │  • 用户数据 │       │  • 分布式锁 │       │  • 声音样本 │
 └─────────────┘       │  • 消息队列 │       │  • 成品下载 │
                       └─────────────┘       └─────────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ▼                      ▼                      ▼
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│  通义千问VL   │      │    豆包API    │      │ 阿里云语音合成 │
│               │      │  (ByteDance)  │      │               │
│ • 镜头内容识别│      │ • 脚本生成    │      │ • 标准TTS     │
│ • 画面质量评估│      │ • 话题标签    │      │ • 声音克隆    │
│ • 场景分类   │      │ • 标题推荐    │      │ • 多音色      │
└───────────────┘      └───────────────┘      └───────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                       视频处理层                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    FFmpeg + OpenCV                       │   │
│  │  • 关键帧抽取        • 视频片段裁剪                       │   │
│  │  • 缩略图生成        • 音视频合并                         │   │
│  │  • 格式转换          • 添加转场效果                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 技术栈选型

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端** | Vue 3 + TypeScript + Vite | 团队熟悉，开发效率高 |
| **UI框架** | TailwindCSS + Element Plus | 快速开发，风格现代 |
| **视频播放** | Video.js / vue3-video-player | 支持多格式，可定制 |
| **后端** | Java 21 + Spring Cloud | 微服务架构，企业级稳定性 |
| **微服务组件** | Spring Cloud Gateway + Nacos | API网关 + 服务注册发现 |
| **任务队列** | RabbitMQ / Kafka | 视频分析/合成异步处理 |
| **数据库** | MySQL 8.0 + MyBatis-Plus | 结构化数据存储 |
| **缓存** | Redis | 会话/缓存/分布式锁 |
| **对象存储** | 阿里云OSS | 视频文件存储 + CDN加速 |
| **视觉AI** | 通义千问VL | 多模态图像理解，镜头分析 |
| **文本AI** | 豆包 (ByteDance) | 脚本生成、话题标签、标题推荐 |
| **TTS服务** | 阿里云语音合成 | 标准音色 + 声音克隆 |
| **视频处理** | FFmpeg + OpenCV | 抽帧、剪辑、合成 |

### 4.3 微服务架构设计（为2.0 iOS版本做准备）

```
                                    ┌─────────────────┐
                                    │   Web Client    │
                                    │   (Vue 3)       │
                                    └────────┬────────┘
                                             │
                                    ┌────────▼────────┐
                                    │   API Gateway   │
                                    │ (Spring Cloud   │
                                    │    Gateway)     │
                                    └────────┬────────┘
                                             │
        ┌────────────────┬───────────────────┼───────────────────┬────────────────┐
        ▼                ▼                   ▼                   ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  用户服务    │ │  任务服务    │ │  AI分析服务  │ │  媒体处理服务 │ │  发布辅助服务 │
│ user-service │ │ task-service │ │ ai-service   │ │media-service │ │publish-service│
│              │ │              │ │              │ │              │ │              │
│ • 认证授权   │ │ • 任务管理   │ │ • 镜头分析   │ │ • TTS配音    │ │ • 话题推荐   │
│ • 会员管理   │ │ • 进度跟踪   │ │ • 脚本生成   │ │ • 声音克隆   │ │ • 标题生成   │
│ • 用户配置   │ │ • 结果存储   │ │ • 质量评估   │ │ • 视频合成   │ │              │
│ • 声音样本   │ │              │ │              │ │ • 视频裁剪   │ │              │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
        │                │                   │                   │                │
        └────────────────┴───────────────────┴───────────────────┴────────────────┘
                                             │
                         ┌───────────────────┼───────────────────┐
                         ▼                   ▼                   ▼
                  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
                  │   MySQL     │     │   Redis     │     │ 阿里云OSS   │
                  │  (主从复制) │     │   Cluster   │     │   + CDN     │
                  └─────────────┘     └─────────────┘     └─────────────┘
```

**微服务设计原则（兼顾2.0 iOS版本）：**
- **API版本化**：`/api/v1/...`，便于后续iOS版本接口演进
- **统一认证**：JWT Token，支持Web/iOS多端登录
- **用户数据同步**：声音样本、历史任务等跨端同步
- **推送通知预留**：任务完成通知，后续对接APNs

### 4.3 核心处理流程

```
用户上传视频
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  1. 视频接收 & 预处理                                        │
│  ───────────────────────────────────────────────────────────│
│  • 上传到OSS，获取文件URL                                    │
│  • 使用FFmpeg提取关键帧（每2秒1帧）                          │
│  • 生成视频缩略图                                            │
│  • 获取视频元信息（时长、分辨率）                             │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  2. AI镜头分析（并行处理每个视频）                            │
│  ───────────────────────────────────────────────────────────│
│  • 将关键帧发送给多模态AI模型                                │
│  • 获取分析结果：                                            │
│    - 内容分类：食物/人物/环境/其他                           │
│    - 具体标签：火锅、烤肉、门店招牌、达人微笑...              │
│    - 画面描述：一句话描述画面内容                            │
│    - 质量评分：0-100分（清晰度+构图+稳定性）                 │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 镜头筛选 & 排序                                          │
│  ───────────────────────────────────────────────────────────│
│  • 按分类归组                                                │
│  • 每类按质量评分排序                                        │
│  • 标记推荐镜头（每类Top2）                                  │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 脚本生成                                                 │
│  ───────────────────────────────────────────────────────────│
│  • 调用LLM生成口播脚本                                       │
│  • 分段落对应具体镜头                                        │
│  • 支持用户手动编辑修改                                      │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  5. TTS配音合成 (NEW)                                        │
│  ───────────────────────────────────────────────────────────│
│  • 将脚本文本发送到TTS服务                                   │
│  • 使用用户选择的音色                                        │
│  • 生成配音音频文件（MP3/WAV）                               │
│  • 获取各段落配音时长                                        │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  6. 视频片段裁剪 (NEW)                                       │
│  ───────────────────────────────────────────────────────────│
│  • 根据脚本段落对应的镜头                                    │
│  • 按配音时长裁剪视频片段                                    │
│  • 使用FFmpeg提取指定时间段                                  │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  7. 音视频合成 (NEW)                                         │
│  ───────────────────────────────────────────────────────────│
│  • 按脚本顺序拼接视频片段                                    │
│  • 叠加配音音轨                                              │
│  • 添加简单转场效果（可选）                                  │
│  • 输出成品MP4视频                                           │
└─────────────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────────────────────────────┐
│  8. 结果存储 & 返回                                          │
│  ───────────────────────────────────────────────────────────│
│  • 成品视频上传到OSS                                         │
│  • 存储分析结果和成品信息到数据库                            │
│  • 通过WebSocket/轮询通知前端完成                            │
│  • 返回预览URL和下载URL                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 五、数据库设计

### 5.1 核心表结构

```sql
-- 用户表
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    phone VARCHAR(20) UNIQUE,
    nickname VARCHAR(50),
    avatar_url VARCHAR(500),
    membership_type ENUM('free', 'basic', 'pro') DEFAULT 'free',
    membership_expire_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 任务表
CREATE TABLE tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,

    -- 店铺信息
    shop_name VARCHAR(200) NOT NULL,
    shop_type ENUM('food', 'beauty', 'entertainment', 'other') NOT NULL,
    promotion_text TEXT,
    video_style ENUM('recommend', 'review', 'vlog') NOT NULL,

    -- 配音设置
    voice_type VARCHAR(50) DEFAULT 'xiaomei',  -- NEW: 音色选择

    -- 任务状态
    status ENUM('uploading', 'analyzing', 'scripting', 'voicing', 'composing', 'completed', 'failed') DEFAULT 'uploading',
    progress INT DEFAULT 0,  -- 0-100
    error_message TEXT,

    -- AI生成结果
    generated_script TEXT,

    -- 成品视频信息 (NEW)
    output_video_url VARCHAR(1000),
    output_video_duration INT,  -- 成品时长(秒)
    output_video_size BIGINT,   -- 文件大小(bytes)

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- 视频素材表
CREATE TABLE videos (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,

    -- 文件信息
    original_filename VARCHAR(500),
    oss_key VARCHAR(500) NOT NULL,
    oss_url VARCHAR(1000),
    thumbnail_url VARCHAR(1000),
    duration_seconds INT,
    file_size_bytes BIGINT,

    -- AI分析结果
    category ENUM('food', 'person', 'environment', 'other'),
    tags JSON,  -- ["火锅", "毛肚", "特写"]
    description TEXT,
    quality_score INT,  -- 0-100
    is_recommended BOOLEAN DEFAULT FALSE,

    -- 分析状态
    analysis_status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',

    -- 使用信息 (NEW)
    used_in_output BOOLEAN DEFAULT FALSE,  -- 是否被用于成品
    used_segment_start INT,                 -- 使用的片段起始秒
    used_segment_end INT,                   -- 使用的片段结束秒

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_task_id (task_id),
    INDEX idx_category (category),
    INDEX idx_quality_score (quality_score)
);

-- 配音记录表 (NEW)
CREATE TABLE voice_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,

    -- 配音信息
    voice_type VARCHAR(50) NOT NULL,
    script_text TEXT NOT NULL,
    audio_url VARCHAR(1000),
    duration_seconds INT,

    -- 段落信息
    segment_index INT,           -- 脚本段落序号
    segment_title VARCHAR(100),  -- 段落标题，如"开场"

    -- 状态
    status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_task_id (task_id)
);

-- 用户声音样本表 (NEW - 声音克隆)
CREATE TABLE user_voice_samples (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,

    -- 样本信息
    sample_name VARCHAR(100) DEFAULT '我的声音',
    oss_key VARCHAR(500) NOT NULL,
    oss_url VARCHAR(1000),
    duration_seconds INT,
    file_size_bytes BIGINT,

    -- 克隆状态
    clone_status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
    clone_voice_id VARCHAR(200),  -- 阿里云返回的克隆音色ID
    error_message TEXT,

    -- 元数据
    is_default BOOLEAN DEFAULT TRUE,  -- 用户默认音色
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_clone_status (clone_status)
);

-- 任务发布辅助表 (NEW - 话题&标题推荐)
CREATE TABLE task_publish_assists (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL UNIQUE,

    -- AI生成的推荐内容
    hot_topics JSON,       -- ["#话题1", "#话题2", ...]
    title_suggestions JSON, -- ["标题1", "标题2", ...]

    -- 用户选择记录
    selected_topics JSON,
    selected_title VARCHAR(500),

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_task_id (task_id)
);

-- 用户会员订单表
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    order_no VARCHAR(50) UNIQUE NOT NULL,
    product_type VARCHAR(50) NOT NULL,
    amount_cents INT NOT NULL,
    status ENUM('pending', 'paid', 'refunded') DEFAULT 'pending',
    paid_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no)
);

-- 用户设备表 (NEW - 为iOS 2.0预留)
CREATE TABLE user_devices (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,

    -- 设备信息
    device_type ENUM('web', 'ios', 'android') NOT NULL,
    device_id VARCHAR(200),
    device_name VARCHAR(100),
    push_token VARCHAR(500),  -- APNs/FCM推送token

    -- 状态
    is_active BOOLEAN DEFAULT TRUE,
    last_active_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_device_type (device_type)
);
```

---

## 六、API设计

### 6.1 核心接口

> **API版本化设计**：所有接口使用 `/api/v1/` 前缀，便于后续iOS 2.0版本接口演进

```yaml
# 任务相关
POST   /api/v1/tasks                    # 创建任务
GET    /api/v1/tasks                    # 获取任务列表
GET    /api/v1/tasks/{id}               # 获取任务详情
DELETE /api/v1/tasks/{id}               # 删除任务

# 视频上传
POST   /api/v1/tasks/{id}/videos/upload-url   # 获取上传预签名URL
POST   /api/v1/tasks/{id}/videos              # 确认上传完成
GET    /api/v1/tasks/{id}/videos              # 获取视频列表

# AI分析
POST   /api/v1/tasks/{id}/analyze       # 开始分析
GET    /api/v1/tasks/{id}/progress      # 获取分析进度

# 脚本
GET    /api/v1/tasks/{id}/script        # 获取生成的脚本
PUT    /api/v1/tasks/{id}/script        # 更新脚本(用户编辑)
POST   /api/v1/tasks/{id}/regenerate-script   # 重新生成脚本

# 配音&合成
POST   /api/v1/tasks/{id}/compose       # 开始配音&视频合成
PUT    /api/v1/tasks/{id}/voice-type    # 修改音色选择
GET    /api/v1/tasks/{id}/compose-progress  # 获取合成进度

# 成品
GET    /api/v1/tasks/{id}/output        # 获取成品视频信息
GET    /api/v1/tasks/{id}/output/download  # 获取下载链接
GET    /api/v1/tasks/{id}/assets-pack   # 获取素材包下载链接

# 发布辅助 (NEW - 话题&标题)
GET    /api/v1/tasks/{id}/publish-assist    # 获取话题标签和标题推荐
POST   /api/v1/tasks/{id}/publish-assist/regenerate  # 重新生成推荐

# 声音克隆 (NEW)
POST   /api/v1/voice/upload-url         # 获取声音样本上传URL
POST   /api/v1/voice/samples            # 确认上传并开始克隆
GET    /api/v1/voice/samples            # 获取用户的声音样本列表
GET    /api/v1/voice/samples/{id}       # 获取声音样本详情
DELETE /api/v1/voice/samples/{id}       # 删除声音样本
GET    /api/v1/voice/samples/{id}/preview  # 试听克隆声音

# 用户认证
POST   /api/v1/auth/send-code           # 发送验证码
POST   /api/v1/auth/login               # 登录
POST   /api/v1/auth/refresh             # 刷新Token
POST   /api/v1/auth/logout              # 登出

# 用户信息
GET    /api/v1/user/profile             # 获取用户信息
PUT    /api/v1/user/profile             # 更新用户信息

# 设备管理 (为iOS 2.0预留)
POST   /api/v1/devices                  # 注册设备
PUT    /api/v1/devices/{id}/push-token  # 更新推送Token
DELETE /api/v1/devices/{id}             # 注销设备
```

### 6.2 关键接口示例

```json
// POST /api/tasks - 创建任务
Request:
{
    "shop_name": "海底捞火锅(望京店)",
    "shop_type": "food",
    "promotion_text": "人均89，必点招牌毛肚，团购立减30",
    "video_style": "recommend"
}

Response:
{
    "id": 12345,
    "status": "uploading",
    "upload_token": "xxx"
}

// POST /api/tasks/{id}/compose - 开始配音&合成 (NEW)
Request:
{
    "voice_type": "xiaomei",
    "script_confirmed": true
}

Response:
{
    "task_id": 12345,
    "status": "voicing",
    "estimated_minutes": 5
}

// GET /api/tasks/{id}/output - 获取成品信息 (NEW)
Response:
{
    "task_id": 12345,
    "status": "completed",
    "output": {
        "video_url": "https://oss.../output/12345.mp4",
        "preview_url": "https://oss.../output/12345_preview.mp4",
        "duration_seconds": 62,
        "file_size_mb": 45.6,
        "resolution": "1080x1920",
        "created_at": "2026-01-14T10:35:00Z"
    },
    "used_shots": [
        {"video_id": 1, "category": "person", "segment": "0-8s"},
        {"video_id": 3, "category": "environment", "segment": "2-8s"},
        {"video_id": 5, "category": "food", "segment": "0-12s"}
    ]
}

// GET /api/v1/tasks/{id} - 获取任务详情 (完整)
Response:
{
    "id": 12345,
    "shop_name": "海底捞火锅(望京店)",
    "shop_type": "food",
    "status": "completed",
    "progress": 100,
    "videos": [
        {
            "id": 1,
            "thumbnail_url": "https://...",
            "category": "food",
            "tags": ["火锅", "毛肚", "特写"],
            "description": "一盘新鲜毛肚的特写镜头，摆盘精美",
            "quality_score": 95,
            "is_recommended": true,
            "used_in_output": true
        }
    ],
    "generated_script": "【开场】(对应镜头: 达人出镜#1)\n...",
    "voice_type": "xiaomei",
    "output": {
        "video_url": "https://oss.../output/12345.mp4",
        "duration_seconds": 62,
        "file_size_mb": 45.6
    },
    "created_at": "2026-01-14T10:30:00Z"
}

// GET /api/v1/tasks/{id}/publish-assist - 获取发布辅助 (NEW)
Response:
{
    "task_id": 12345,
    "hot_topics": [
        "#海底捞", "#火锅探店", "#望京美食", "#必吃榜", "#美食推荐",
        "#吃货日常", "#探店达人", "#北京美食", "#团购优惠", "#周末去哪吃"
    ],
    "title_suggestions": [
        "望京这家海底捞太绝了！服务好到让你感动流泪",
        "人均89吃海底捞？这个团购也太香了吧！",
        "海底捞探店｜必点招牌毛肚，七上八下太嫩了",
        "朋友聚餐首选！望京海底捞氛围感拉满"
    ],
    "generated_at": "2026-01-14T10:35:00Z"
}

// POST /api/v1/voice/samples - 上传声音样本并开始克隆 (NEW)
Request:
{
    "oss_key": "voice-samples/user123/sample1.mp3",
    "sample_name": "我的声音",
    "duration_seconds": 45
}

Response:
{
    "id": 1,
    "user_id": 123,
    "sample_name": "我的声音",
    "clone_status": "processing",
    "estimated_minutes": 3,
    "message": "声音克隆处理中，预计3分钟完成"
}

// GET /api/v1/voice/samples - 获取声音样本列表 (NEW)
Response:
{
    "samples": [
        {
            "id": 1,
            "sample_name": "我的声音",
            "clone_status": "completed",
            "clone_voice_id": "voice_clone_abc123",
            "is_default": true,
            "created_at": "2026-01-10T15:20:00Z"
        }
    ]
}
```

---

## 七、AI Prompt 设计

### 7.1 镜头分析Prompt

```
你是一个专业的短视频内容分析师，擅长分析探店类视频素材。

请分析以下视频帧截图，返回JSON格式的分析结果：

{
    "category": "food|person|environment|other",
    "tags": ["标签1", "标签2", ...],  // 最多5个具体标签
    "description": "一句话描述画面内容",
    "quality_assessment": {
        "clarity": 0-100,      // 清晰度
        "composition": 0-100,  // 构图
        "lighting": 0-100,     // 光线
        "stability": 0-100     // 稳定性(是否模糊)
    },
    "overall_score": 0-100,
    "recommendation": "推荐原因或不推荐原因"
}

分类标准：
- food: 食物、菜品、饮品的画面
- person: 有人物出镜的画面（达人、店员等）
- environment: 店铺环境、装修、门店外观
- other: 以上都不符合的其他画面
```

### 7.2 脚本生成Prompt

```
你是一个专业的探店短视频脚本撰写专家，擅长创作抖音、小红书风格的爆款探店文案。

## 任务
根据以下信息，生成一个约60秒的探店口播脚本。

## 店铺信息
- 名称：{shop_name}
- 类型：{shop_type}
- 优惠信息：{promotion_text}

## 视频风格
{video_style_description}

## 可用镜头素材
{shots_summary}

## 输出要求
1. 分5-7个段落，每段标注对应的镜头编号
2. 开头必须有强吸引力的hook（前3秒决定生死）
3. 中间要有具体的体验描述和情感表达
4. 必须自然植入优惠信息
5. 结尾要有互动引导（关注、评论、点赞）
6. 语言口语化，符合短视频风格
7. 每段配上对应的镜头建议
8. 控制每段字数，确保配音后时长合理（约10-15秒/段）

## 输出格式
【开场hook】(镜头: xxx, 预计8秒)
文案内容...

【环境介绍】(镜头: xxx, 预计6秒)
文案内容...

...
```

---

## 八、开发计划

### 8.1 V1.0 MVP阶段

| 阶段 | 任务 | 交付物 |
|------|------|--------|
| **Phase 1** | 项目搭建 | 前后端脚手架、数据库、OSS配置 |
| **Phase 2** | 核心上传流程 | 视频上传、任务管理、基础UI |
| **Phase 3** | AI分析集成 | 镜头分析、脚本生成接口 |
| **Phase 4** | TTS配音集成 | 阿里云/讯飞TTS对接、音色选择 |
| **Phase 5** | 视频合成 | FFmpeg裁剪、拼接、音视频合并 |
| **Phase 6** | 预览导出 | 播放器组件、下载功能 |
| **Phase 7** | 优化测试 | Bug修复、性能优化、内测反馈 |

### 8.2 版本路线图

```
V1.0 (MVP)
├── 完整流程: 上传→分析→脚本→配音→合成→导出
├── Web端
├── 内测验证 (100-500用户)
└── 基础定价体系

V1.x (优化迭代)
├── 更多TTS音色选择
├── 剪辑风格模板
├── 批量任务处理
├── 用户反馈优化
└── 性能优化

V2.0 (iOS App)
├── 原生iOS应用
├── 会员订阅体系
├── Apple Pay支付
├── 推送通知
└── 移动端专属功能
```

---

## 九、成本估算

### 9.1 单次任务成本 (V1.0)

| 项目 | 计算方式 | 成本 |
|------|----------|------|
| 视频存储(源) | 20个视频 × 50MB × ¥0.12/GB | ¥0.12 |
| 视频存储(成品) | 1个视频 × 50MB × ¥0.12/GB | ¥0.10 |
| AI视觉分析(通义千问VL) | 20视频 × 10帧 × ¥0.01/帧 | ¥2.00 |
| LLM脚本生成(豆包) | ~2000 tokens × ¥0.008/千token | ¥0.02 |
| **话题&标题推荐(豆包)** | ~500 tokens × ¥0.008/千token | **¥0.01** |
| **TTS配音(阿里云)** | ~500字 × ¥0.02/百字 | **¥0.10** |
| **视频合成计算** | ~5分钟处理 × ¥0.1/分钟 | **¥0.50** |
| 服务器计算 | ~5分钟 × ¥0.1/分钟 | ¥0.50 |
| **合计** | | **~¥3.4/次** |

### 9.2 声音克隆成本 (一次性)

| 项目 | 计算方式 | 成本 |
|------|----------|------|
| 声音样本存储 | 1个样本 × 5MB | ¥0.01 |
| 声音克隆处理 | 阿里云声音复刻 | ¥5-10/次 |
| **说明** | 克隆一次可永久使用 | - |

### 9.2 定价建议

| 套餐 | 价格 | 包含次数 | 单次成本 | 毛利率 |
|------|------|----------|----------|--------|
| 免费体验 | ¥0 | 2次 | - | - |
| 基础包 | ¥39 | 15次 | ¥2.6 | 24% |
| 月卡 | ¥99 | 50次 | ¥2.0 | 41% |
| 年卡 | ¥799 | 无限 | - | - |

---

## 十、风险与对策

| 风险 | 影响 | 对策 |
|------|------|------|
| AI分析准确率不够 | 用户体验差 | 多模型对比测试，持续优化Prompt |
| 视频上传失败率高 | 用户流失 | 分片上传、断点续传、多CDN |
| AI成本超预期 | 亏损 | 缓存策略、限制免费次数 |
| 脚本质量不稳定 | 口碑差 | 多模板、人工审核机制 |
| **TTS音质不满足预期** | 用户不满 | 提供多音色选择，后续可升级高端TTS |
| **视频合成耗时过长** | 用户等待焦虑 | 优化FFmpeg参数，明确进度提示 |
| **成品文件过大** | 下载慢 | 压缩优化，提供不同质量选项 |

---

## 附录：项目结构建议

```
shop-video-scout/
│
├── frontend/                           # 前端项目 (Vue 3 + Vite)
│   ├── src/
│   │   ├── components/                # 通用组件
│   │   │   ├── VideoPlayer/           # 视频播放器
│   │   │   ├── VoiceSelector/         # 音色选择器(含克隆)
│   │   │   ├── TopicTags/             # 话题标签组件
│   │   │   └── TitleSuggestions/      # 标题推荐组件
│   │   ├── views/                     # 页面
│   │   │   ├── Create/                # 创建任务页
│   │   │   ├── Task/                  # 任务详情页
│   │   │   ├── Result/                # 结果预览页
│   │   │   └── VoiceClone/            # 声音克隆页
│   │   ├── composables/               # 组合式函数
│   │   ├── api/                       # API调用
│   │   ├── stores/                    # Pinia状态管理
│   │   └── utils/                     # 工具函数
│   ├── vite.config.ts
│   └── package.json
│
├── services/                           # 后端微服务 (Java 21 + Spring Cloud)
│   │
│   ├── gateway/                        # API网关
│   │   └── src/main/java/.../gateway/
│   │
│   ├── user-service/                   # 用户服务
│   │   └── src/main/java/.../user/
│   │       ├── controller/
│   │       ├── service/
│   │       │   ├── AuthService.java
│   │       │   ├── UserService.java
│   │       │   └── VoiceSampleService.java  # 声音样本管理
│   │       ├── model/
│   │       └── repository/
│   │
│   ├── task-service/                   # 任务服务
│   │   └── src/main/java/.../task/
│   │       ├── controller/
│   │       ├── service/
│   │       │   ├── TaskService.java
│   │       │   └── ProgressService.java
│   │       └── model/
│   │
│   ├── ai-service/                     # AI分析服务
│   │   └── src/main/java/.../ai/
│   │       ├── controller/
│   │       ├── service/
│   │       │   ├── QwenVLService.java      # 通义千问VL
│   │       │   ├── DoubaoService.java      # 豆包API
│   │       │   └── ScriptGenerator.java
│   │       └── client/                     # AI服务客户端
│   │
│   ├── media-service/                  # 媒体处理服务
│   │   └── src/main/java/.../media/
│   │       ├── controller/
│   │       ├── service/
│   │       │   ├── TtsService.java         # 阿里云TTS
│   │       │   ├── VoiceCloneService.java  # 声音克隆
│   │       │   ├── VideoComposer.java      # FFmpeg合成
│   │       │   └── OssService.java         # OSS操作
│   │       └── processor/                  # 视频处理器
│   │
│   ├── publish-service/                # 发布辅助服务
│   │   └── src/main/java/.../publish/
│   │       ├── controller/
│   │       └── service/
│   │           ├── TopicService.java       # 话题推荐
│   │           └── TitleService.java       # 标题生成
│   │
│   └── common/                         # 公共模块
│       ├── common-core/                # 核心工具
│       ├── common-security/            # 安全认证
│       └── common-oss/                 # OSS封装
│
├── docs/                               # 文档
│   ├── prd.md
│   ├── 拍后合成-产品方案.md
│   ├── proposals/                      # 变更提案
│   ├── api/                            # API文档
│   │   └── openapi.yaml
│   └── architecture/                   # 架构文档
│
├── deploy/                             # 部署配置
│   ├── docker/
│   │   ├── docker-compose.yml
│   │   └── Dockerfile.*
│   ├── k8s/                            # K8s配置(可选)
│   └── nginx/
│
└── scripts/                            # 脚本
    ├── init-db.sql
    └── deploy.sh
```

---

## 变更记录

| 日期 | 版本 | 变更内容 | 提案编号 |
|------|------|----------|----------|
| 2026-01-14 | 1.1 | V1.0扩展为完整流程，新增配音合成、视频剪辑、预览导出 | PCP-2026-001 |
| 2026-01-14 | 1.2 | 新增热门话题推荐、标题建议、声音克隆功能；技术栈调整为Vue3+Java21+Spring Cloud；微服务架构设计 | PCP-2026-001 |
