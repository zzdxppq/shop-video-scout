# Story 4.1: TTS配音服务实现

## Status
Draft

## Story

**As a** 系统,
**I want** 将脚本文本转换为语音音频,
**so that** 用户无需自己录制配音

## Acceptance Criteria

### AC1: 标准音色配音

**Scenario**
```gherkin
GIVEN 用户确认脚本并选择音色
WHEN 开始配音合成
THEN
  - 将脚本文本发送到火山引擎Seed-TTS服务
  - 使用选择的标准音色
  - 生成配音音频文件
  - 获取各段落配音时长
  - 上传音频到OSS
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | 标准音色：活泼女声、阳光男声、知性女声（火山引擎100+预设音色库） |
| BR-1.2 | 配音采样率48000Hz |
| BR-1.3 | 输出格式MP3 |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| TTS服务超时 | 504 | 配音生成超时，正在重试 | 自动重试3次 |
| 文本过长 | 400 | 单次配音文本不能超过5000字 | 分段处理 |

---

### AC2: 配音进度跟踪

**Scenario**
```gherkin
GIVEN 配音合成进行中
WHEN 查询进度
THEN
  - 返回已完成段落数
  - 返回总段落数
  - 返回预计剩余时间
```

---

## Tasks / Subtasks

- [ ] **T1: 火山引擎Seed-TTS SDK集成** `[AC1]`
- [ ] **T2: 音色选择逻辑** `[AC1]`
- [ ] **T3: 配音任务队列** `[AC2]`

## Dev Notes

### Provides APIs
- `POST /api/v1/tasks/{id}/compose`
- `PUT /api/v1/tasks/{id}/voice-type`
- `GET /api/v1/tasks/{id}/compose-progress`

### Dependencies
- 依赖 Story 3.1 (AI脚本生成)

### Technical Note
TTS服务已从阿里云迁移至火山引擎Seed-TTS（TCP-2026-002）

---

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-22 | SM | Created → Draft | Story created from PRD Epic 4 |
