# Story 5.2: 下载导出功能

## Status
Draft

## Story

**As a** 用户,
**I want** 下载合成完成的视频和素材,
**so that** 可以在本地保存和使用

## Acceptance Criteria

### AC1: 下载成品视频

**Scenario**
```gherkin
GIVEN 用户在结果页面
WHEN 用户点击下载成品
THEN
  - 获取带签名的下载URL
  - 触发浏览器下载
  - 显示下载进度（如支持）
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | 下载链接有效期1小时 |
| BR-1.2 | 文件名格式：{店铺名}-探店视频-{日期}.mp4 |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| 链接过期 | 401 | 下载链接已过期，正在刷新 | 自动获取新链接 |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| 点击下载 | 显示下载中状态，触发下载 |

---

### AC2: 下载素材包

**Scenario**
```gherkin
GIVEN 用户需要原始推荐镜头
WHEN 用户点击下载素材包
THEN
  - 打包所有推荐镜头原片
  - 生成ZIP文件
  - 提供下载链接
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-2.1 | 素材包仅包含推荐镜头 |
| BR-2.2 | ZIP文件名：{店铺名}-素材包-{日期}.zip |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| 打包失败 | 500 | 素材包生成失败，请重试 | 显示重试按钮 |

---

## Tasks / Subtasks

- [ ] **T1: 下载视频API** `[AC1]`
- [ ] **T2: 素材包打包API** `[AC2]`
- [ ] **T3: 下载按钮组件** `[AC1, AC2]`

## Dev Notes

### Provides APIs
- `GET /api/v1/tasks/{id}/output/download`
- `GET /api/v1/tasks/{id}/assets-pack`

### Dependencies
- 依赖 Story 5.1 (视频预览播放器)

---

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-22 | SM | Created → Draft | Story created from PRD Epic 5 |
