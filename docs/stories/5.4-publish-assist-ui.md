---
id: "5.4"
title: "å‘å¸ƒè¾…åŠ©UIç»„ä»¶"
epic: "5 - é¢„è§ˆå¯¼å‡ºä¸å‘å¸ƒè¾…åŠ©"
status: Done
mode: plan
repository: monolith
priority: P0
estimated_complexity: low
tier: simple
---

# Story 5.4: å‘å¸ƒè¾…åŠ©UIç»„ä»¶

## Story

**As a** ç”¨æˆ·,
**I want** æŸ¥çœ‹å’Œå¤åˆ¶æ¨èçš„è¯é¢˜å’Œæ ‡é¢˜,
**so that** å¯ä»¥æ–¹ä¾¿åœ°å‘å¸ƒè§†é¢‘åˆ°ç¤¾äº¤å¹³å°

### ğŸ”Œ APIs Consumed by This Story

- `GET /api/v1/publish/tasks/{id}/assist` (from Story 5.3 - get topics and titles)
- `POST /api/v1/publish/tasks/{id}/assist/regenerate` (from Story 5.3 - regenerate content)

## Epic Context

**Epic**: 5 - é¢„è§ˆå¯¼å‡ºä¸å‘å¸ƒè¾…åŠ©

å®ç°æˆå“è§†é¢‘çš„åœ¨çº¿é¢„è§ˆæ’­æ”¾ã€ä¸‹è½½å¯¼å‡ºåŠŸèƒ½ï¼Œé›†æˆAIç”Ÿæˆçƒ­é—¨è¯é¢˜æ ‡ç­¾å’Œè§†é¢‘æ ‡é¢˜æ¨èï¼Œæå‡å‘å¸ƒæ•ˆç‡ã€‚

**Story Deliverables**:
- å‘å¸ƒè¾…åŠ©é¢æ¿ç»„ä»¶ (PublishAssistPanel)
- è¯é¢˜æ ‡ç­¾èŠ¯ç‰‡ç»„ä»¶ (TopicChips)
- æ ‡é¢˜åˆ—è¡¨ç»„ä»¶ (TitleList)
- å‰ªè´´æ¿å¤åˆ¶é€»è¾‘ (useClipboard composable)
- å‘å¸ƒè¾…åŠ©æ•°æ®è·å– (usePublishAssist composable)
- APIæ¨¡å— (publish.ts)

## Acceptance Criteria

### AC1: è¯é¢˜æ ‡ç­¾å±•ç¤ºä¸å¤åˆ¶

**Scenario**
```gherkin
GIVEN ç”¨æˆ·åœ¨ç»“æœé¡µé¢
WHEN æŸ¥çœ‹è¯é¢˜æ¨è
THEN
  - æ˜¾ç¤ºè¯é¢˜æ ‡ç­¾åˆ—è¡¨ï¼ˆèŠ¯ç‰‡æ ·å¼ï¼‰
  - æ”¯æŒä¸€é”®å¤åˆ¶æ‰€æœ‰è¯é¢˜
  - æ”¯æŒå•ä¸ªè¯é¢˜å¤åˆ¶
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | è¯é¢˜æ ‡ç­¾æ˜¾ç¤ºä¸ºèŠ¯ç‰‡/æ ‡ç­¾æ ·å¼ï¼ˆåœ†è§’çŸ©å½¢ï¼Œå¸¦èƒŒæ™¯è‰²ï¼‰ |
| BR-1.2 | å¤åˆ¶åæ˜¾ç¤ºæˆåŠŸæç¤ºToastï¼ˆ"å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"ï¼Œ2ç§’æ¶ˆå¤±ï¼‰ |
| BR-1.3 | ä¸€é”®å¤åˆ¶æ—¶æ‰€æœ‰è¯é¢˜ç”¨ç©ºæ ¼åˆ†éš”ï¼ˆå¦‚ "#è¯é¢˜1 #è¯é¢˜2 #è¯é¢˜3"ï¼‰ |
| BR-1.4 | å•ä¸ªè¯é¢˜ç‚¹å‡»æ—¶å¤åˆ¶è¯¥è¯é¢˜æ–‡æœ¬ |
| BR-1.5 | è¯é¢˜æŒ‰APIè¿”å›é¡ºåºæ˜¾ç¤ºï¼ˆæ¨èä¼˜å…ˆçº§æ’åºï¼‰ |
| BR-1.6 | è¯é¢˜èŠ¯ç‰‡æœ€å¤šæ˜¾ç¤º10ä¸ªï¼ˆAPIè¿”å›5-10ä¸ªï¼‰ |

**Data Validation**
| Field | Type | Required | Rules | Error Message |
|-------|------|----------|-------|---------------|
| topics | string[] | Y | length 5-10 | è¯é¢˜æ•°æ®åŠ è½½å¤±è´¥ |
| topic | string | Y | starts with # | è¯é¢˜æ ¼å¼å¼‚å¸¸ |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| APIåŠ è½½å¤±è´¥ | 500 | è¯é¢˜åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯• | æ˜¾ç¤ºé‡è¯•æŒ‰é’® |
| å‰ªè´´æ¿å¤åˆ¶å¤±è´¥ | - | å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ | æ˜¾ç¤ºå¤±è´¥Toast |
| ç©ºæ•°æ® | - | æš‚æ— è¯é¢˜æ¨è | æ˜¾ç¤ºç©ºçŠ¶æ€ |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| ç‚¹å‡»ä¸€é”®å¤åˆ¶æŒ‰é’® | å¤åˆ¶æ‰€æœ‰è¯é¢˜åˆ°å‰ªè´´æ¿ï¼Œæ˜¾ç¤ºæˆåŠŸToast |
| ç‚¹å‡»å•ä¸ªè¯é¢˜èŠ¯ç‰‡ | å¤åˆ¶è¯¥è¯é¢˜ï¼Œæ˜¾ç¤º"å·²å¤åˆ¶: #è¯é¢˜"Toast |
| æ‚¬åœè¯é¢˜èŠ¯ç‰‡ | æ˜¾ç¤ºhoverçŠ¶æ€ï¼ˆé¢œè‰²åŠ æ·±ï¼‰ |

---

### AC2: æ ‡é¢˜æ¨èå±•ç¤ºä¸å¤åˆ¶

**Scenario**
```gherkin
GIVEN ç”¨æˆ·åœ¨ç»“æœé¡µé¢
WHEN æŸ¥çœ‹æ ‡é¢˜æ¨è
THEN
  - æ˜¾ç¤ºæ ‡é¢˜é€‰é¡¹åˆ—è¡¨
  - æ¯ä¸ªæ ‡é¢˜å¸¦å¤åˆ¶æŒ‰é’®
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-2.1 | æ ‡é¢˜æ˜¾ç¤ºä¸ºå¡ç‰‡åˆ—è¡¨æ ·å¼ï¼ˆæ¯ä¸ªæ ‡é¢˜ä¸€è¡Œï¼‰ |
| BR-2.2 | ç¬¬ä¸€ä¸ªæ ‡é¢˜æ ‡è®°ä¸º"æ¨è"ï¼ˆå¸¦æ¨èå¾½ç« ï¼‰ |
| BR-2.3 | æ¯ä¸ªæ ‡é¢˜å³ä¾§æœ‰å¤åˆ¶å›¾æ ‡æŒ‰é’® |
| BR-2.4 | å¤åˆ¶åæ˜¾ç¤ºæˆåŠŸToast |
| BR-2.5 | æ ‡é¢˜æœ€å¤šæ˜¾ç¤º5ä¸ªï¼ˆAPIè¿”å›3-5ä¸ªï¼‰ |
| BR-2.6 | æ ‡é¢˜è¶…é•¿æ—¶æˆªæ–­æ˜¾ç¤ºï¼Œæ‚¬åœæ˜¾ç¤ºå®Œæ•´å†…å®¹ |

**Data Validation**
| Field | Type | Required | Rules | Error Message |
|-------|------|----------|-------|---------------|
| titles | string[] | Y | length 3-5 | æ ‡é¢˜æ•°æ®åŠ è½½å¤±è´¥ |
| title | string | Y | 20-50 chars | æ ‡é¢˜æ ¼å¼å¼‚å¸¸ |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| APIåŠ è½½å¤±è´¥ | 500 | æ ‡é¢˜åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯• | æ˜¾ç¤ºé‡è¯•æŒ‰é’® |
| å‰ªè´´æ¿å¤åˆ¶å¤±è´¥ | - | å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ | æ˜¾ç¤ºå¤±è´¥Toast |
| ç©ºæ•°æ® | - | æš‚æ— æ ‡é¢˜æ¨è | æ˜¾ç¤ºç©ºçŠ¶æ€ |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| ç‚¹å‡»å¤åˆ¶æŒ‰é’® | å¤åˆ¶å¯¹åº”æ ‡é¢˜ï¼Œæ˜¾ç¤ºæˆåŠŸToast |
| æ‚¬åœæ ‡é¢˜ | é•¿æ ‡é¢˜æ˜¾ç¤ºå®Œæ•´å†…å®¹tooltip |
| æ‚¬åœå¤åˆ¶æŒ‰é’® | æ˜¾ç¤º"ç‚¹å‡»å¤åˆ¶"æç¤º |

---

### AC3: é‡æ–°ç”ŸæˆUI

**Scenario**
```gherkin
GIVEN ç”¨æˆ·å¯¹å½“å‰æ¨èä¸æ»¡æ„
WHEN ç”¨æˆ·ç‚¹å‡»é‡æ–°ç”ŸæˆæŒ‰é’®
THEN
  - æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  - è°ƒç”¨é‡æ–°ç”ŸæˆAPI
  - æ›´æ–°è¯é¢˜å’Œæ ‡é¢˜æ˜¾ç¤º
  - æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-3.1 | æ˜¾ç¤ºé‡æ–°ç”ŸæˆæŒ‰é’®åŠå‰©ä½™æ¬¡æ•°ï¼ˆ"é‡æ–°ç”Ÿæˆ (å‰©ä½™2æ¬¡)"ï¼‰ |
| BR-3.2 | ç‚¹å‡»åæŒ‰é’®æ˜¾ç¤ºloadingçŠ¶æ€ï¼Œç¦ç”¨ç‚¹å‡» |
| BR-3.3 | å‰©ä½™æ¬¡æ•°ä¸º0æ—¶æŒ‰é’®ç¦ç”¨ï¼Œæ˜¾ç¤º"å·²è¾¾ä¸Šé™" |
| BR-3.4 | ç”ŸæˆæˆåŠŸåæ›´æ–°å†…å®¹ï¼Œæ˜¾ç¤ºæˆåŠŸToast |
| BR-3.5 | ç”Ÿæˆå¤±è´¥åæ˜¾ç¤ºé”™è¯¯Toastï¼Œä¿ç•™åŸå†…å®¹ |

**Data Validation**
| Field | Type | Required | Rules | Error Message |
|-------|------|----------|-------|---------------|
| regenerate_remaining | number | Y | 0-3 | - |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| è¶…è¿‡æ¬¡æ•°é™åˆ¶ | 1031 | å·²è¾¾åˆ°é‡æ–°ç”Ÿæˆæ¬¡æ•°ä¸Šé™ | ç¦ç”¨æŒ‰é’® |
| APIå¤±è´¥ | 500 | é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯• | æ¢å¤æŒ‰é’®çŠ¶æ€ |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| ç‚¹å‡»é‡æ–°ç”Ÿæˆ | æ˜¾ç¤ºloadingï¼Œè°ƒç”¨API |
| APIæˆåŠŸ | æ›´æ–°å†…å®¹ï¼Œæ˜¾ç¤ºæˆåŠŸToast |
| APIå¤±è´¥ | æ˜¾ç¤ºé”™è¯¯Toastï¼Œæ¢å¤æŒ‰é’® |

---

## Tasks / Subtasks

### Infrastructure Tasks (T0)

- [x] **T0: åŸºç¡€æ¶æ„ä¸APIæ¨¡å—** `[ALL ACs]`
  - **File Locations**:
    - `frontend/src/api/publish.ts` (create)
    - `frontend/src/types/publish.ts` (create)
    - `frontend/src/composables/useClipboard.ts` (create)
    - `frontend/src/composables/usePublishAssist.ts` (create)
  - **Subtasks**:
    - [x] T0.1: Create publish.ts API module:
      ```typescript
      export function getPublishAssist(taskId: number): Promise<PublishAssistResponse>
      export function regeneratePublishAssist(taskId: number): Promise<PublishAssistResponse>
      ```
    - [x] T0.2: Create publish.ts type definitions:
      ```typescript
      export interface PublishAssistResponse {
        topics: string[];
        titles: string[];
        regenerate_remaining: number;
      }
      ```
    - [x] T0.3: Create useClipboard composable:
      - `copyToClipboard(text: string): Promise<boolean>`
      - Handle Clipboard API with fallback to execCommand
      - Return success/failure status
    - [x] T0.4: Create usePublishAssist composable:
      - State: `topics`, `titles`, `regenerateRemaining`, `loading`, `error`
      - Actions: `fetchPublishAssist(taskId)`, `regenerate(taskId)`
      - Handle loading and error states
  - **Complexity**: Low
  - **AC Traceability**: Foundation for AC1, AC2, AC3

---

### Feature Implementation Tasks

### AC1: è¯é¢˜æ ‡ç­¾èŠ¯ç‰‡ç»„ä»¶

- [x] **T1: TopicChipsç»„ä»¶å®ç°** `[AC1]`
  - **File Locations**:
    - `frontend/src/components/publish/TopicChips.vue` (create)
    - `frontend/src/components/publish/__tests__/TopicChips.test.ts` (create)
  - **Subtasks**:
    - [x] T1.1: Create TopicChips.vue component:
      - Props: `topics: string[]`
      - Emits: `copy(topic: string)`, `copyAll`
      - Display: chip-style tags in flex-wrap container
    - [x] T1.2: Implement single topic click-to-copy:
      - Call useClipboard.copyToClipboard
      - Emit copy event for parent to show Toast
    - [x] T1.3: Implement "ä¸€é”®å¤åˆ¶" button:
      - Join topics with space: `topics.join(' ')`
      - Emit copyAll event
    - [x] T1.4: Style chips with Tailwind:
      - Background: bg-blue-100 (light blue)
      - Text: text-blue-700
      - Hover: bg-blue-200
      - Rounded: rounded-full
      - Padding: px-3 py-1
      - Cursor: pointer
    - [x] T1.5: Handle empty state (show "æš‚æ— è¯é¢˜æ¨è")
  - **Complexity**: Low
  - **Error Handling**:
    | Scenario | Handler |
    |----------|---------|
    | Empty topics array | Show empty state message |
    | Clipboard error | Emit error event for parent to handle |

  **Test Specs** (unit):
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | Render topics as chips | ["#è¯é¢˜1", "#è¯é¢˜2"] | 2 chip elements | unit |
  | Click chip copies | click chip "#è¯é¢˜1" | copyToClipboard("#è¯é¢˜1") called | unit |
  | Click copyAll | click "ä¸€é”®å¤åˆ¶" | copyToClipboard("#è¯é¢˜1 #è¯é¢˜2") called | unit |
  | Empty state | [] | shows "æš‚æ— è¯é¢˜æ¨è" | unit |
  | Chip style correct | any | has bg-blue-100 class | unit |

---

### AC2: æ ‡é¢˜åˆ—è¡¨ç»„ä»¶

- [x] **T2: TitleListç»„ä»¶å®ç°** `[AC2]`
  - **File Locations**:
    - `frontend/src/components/publish/TitleList.vue` (create)
    - `frontend/src/components/publish/TitleCard.vue` (create)
    - `frontend/src/components/publish/__tests__/TitleList.test.ts` (create)
  - **Subtasks**:
    - [x] T2.1: Create TitleCard.vue component:
      - Props: `title: string`, `isRecommended: boolean`, `index: number`
      - Emits: `copy`
      - Display: title text, copy icon button, optional "æ¨è" badge
    - [x] T2.2: Implement copy button click:
      - Call useClipboard.copyToClipboard
      - Emit copy event for parent to show Toast
    - [x] T2.3: Create TitleList.vue component:
      - Props: `titles: string[]`
      - Emits: `copy(title: string)`
      - Compose: map titles to TitleCard, first one with isRecommended=true
    - [x] T2.4: Style title cards:
      - Card: bg-white border rounded-lg p-3
      - Title text: text-gray-800, truncate on overflow
      - Copy button: text-gray-400 hover:text-blue-500
      - Recommended badge: bg-orange-100 text-orange-600 text-xs
    - [x] T2.5: Implement title tooltip for long titles
    - [x] T2.6: Handle empty state
  - **Complexity**: Low
  - **Error Handling**:
    | Scenario | Handler |
    |----------|---------|
    | Empty titles array | Show empty state message |
    | Clipboard error | Emit error event for parent to handle |
    | Long title | Truncate with ellipsis, show tooltip on hover |

  **Test Specs** (unit):
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | Render all titles | ["æ ‡é¢˜1", "æ ‡é¢˜2", "æ ‡é¢˜3"] | 3 TitleCard components | unit |
  | First title is recommended | any | first card has isRecommended=true | unit |
  | Click copy button | click | copyToClipboard(title) called | unit |
  | Recommended badge shown | isRecommended=true | shows "æ¨è" badge | unit |
  | Empty state | [] | shows "æš‚æ— æ ‡é¢˜æ¨è" | unit |
  | Long title truncated | 60-char title | text-truncate class applied | unit |

---

### AC3: å‘å¸ƒè¾…åŠ©é¢æ¿ä¸é‡æ–°ç”Ÿæˆ

- [x] **T3: PublishAssistPanelç»„ä»¶å®ç°** `[AC1, AC2, AC3]`
  - **File Locations**:
    - `frontend/src/components/publish/PublishAssistPanel.vue` (create)
    - `frontend/src/components/publish/RegenerateButton.vue` (create)
    - `frontend/src/components/publish/__tests__/PublishAssistPanel.test.ts` (create)
  - **Subtasks**:
    - [x] T3.1: Create RegenerateButton.vue component:
      - Props: `remaining: number`, `loading: boolean`
      - Emits: `regenerate`
      - Display: "é‡æ–°ç”Ÿæˆ (å‰©ä½™Næ¬¡)" or "å·²è¾¾ä¸Šé™"
      - States: normal, loading (spinner), disabled
    - [x] T3.2: Create PublishAssistPanel.vue component:
      - Props: `taskId: number`
      - Uses: usePublishAssist, useClipboard composables
      - Compose: section header + TopicChips + TitleList + RegenerateButton
    - [x] T3.3: Implement data fetching on mount:
      - Call usePublishAssist.fetchPublishAssist(taskId)
      - Handle loading and error states
    - [x] T3.4: Implement regenerate flow:
      - Call usePublishAssist.regenerate(taskId)
      - Show loading state during API call
      - Update content on success
      - Show Toast on success/failure
    - [x] T3.5: Implement Toast notifications:
      - Use existing Toast system from Story 1.3 or create simple toast
      - Success: green, "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"
      - Error: red, error message
    - [x] T3.6: Style panel layout:
      - Section title: text-lg font-semibold
      - Gap between sections: space-y-6
      - Panel card: bg-white rounded-xl shadow-sm p-4
  - **Complexity**: Medium
  - **Error Handling**:
    | Scenario | Handler |
    |----------|---------|
    | Initial load failure | Show error state with retry button |
    | Regenerate failure | Show error toast, keep current content |
    | Copy failure | Show error toast |

  **Test Specs** (unit):
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | Panel fetches data on mount | taskId=123 | fetchPublishAssist(123) called | unit |
  | Panel renders TopicChips | loaded data | TopicChips with topics prop | unit |
  | Panel renders TitleList | loaded data | TitleList with titles prop | unit |
  | Regenerate button shows remaining | remaining=2 | "(å‰©ä½™2æ¬¡)" text | unit |
  | Regenerate button disabled | remaining=0 | button disabled, "å·²è¾¾ä¸Šé™" | unit |
  | Click regenerate | click | regenerate API called | unit |
  | Loading state | loading=true | shows spinner overlay | unit |
  | Error state | error | shows error message + retry | unit |
  | Copy success toast | copy event | shows success toast | unit |

---

### Integration Tasks

- [x] **T4: é›†æˆåˆ°VideoPreviewView** `[ALL ACs]`
  - **File Locations**:
    - `frontend/src/views/VideoPreviewView.vue` (modify - from Story 5.1)
  - **Subtasks**:
    - [x] T4.1: Import and add PublishAssistPanel below ShotList
    - [x] T4.2: Pass taskId prop from route params
    - [x] T4.3: Ensure panel only shows when task status is 'done'
    - [x] T4.4: Test integrated view with video player + shots + publish assist
  - **Complexity**: Low
  - **AC Traceability**: Integration point for AC1, AC2, AC3

- [x] **T5: Final Verification** `[ALL ACs]`
  - **File Locations**:
    - `frontend/src/components/publish/__tests__/*.test.ts` (verify all tests pass)
  - **Subtasks**:
    - [x] T5.1: Run all unit tests
    - [x] T5.2: Verify no lint errors
    - [x] T5.3: Test end-to-end flow in dev server
    - [x] T5.4: Update status â†’ Review
  - **Complexity**: Low

### AC Coverage Matrix

| Task | AC1 | AC2 | AC3 |
|------|:---:|:---:|:---:|
| T0: åŸºç¡€æ¶æ„ä¸APIæ¨¡å— | âœ“ | âœ“ | âœ“ |
| T1: TopicChipsç»„ä»¶ | âœ“ |   |   |
| T2: TitleListç»„ä»¶ |   | âœ“ |   |
| T3: PublishAssistPanel |   |   | âœ“ |
| T4: é›†æˆåˆ°VideoPreviewView | âœ“ | âœ“ | âœ“ |
| T5: Final Verification | âœ“ | âœ“ | âœ“ |

## Dev Notes

### Technical Constraints

- **Vue 3 Composition API**: All components use `<script setup lang="ts">`
- **Clipboard API**: Use modern Clipboard API with execCommand fallback for older browsers
- **Tailwind CSS**: Use project's existing Tailwind setup for styling
- **Toast System**: Use existing notification system or implement simple toast composable

### Component Hierarchy

```
VideoPreviewView.vue (from 5.1)
â”œâ”€â”€ VideoPlayer.vue
â”œâ”€â”€ ShotList.vue
â”œâ”€â”€ PublishAssistPanel.vue (NEW)
â”‚   â”œâ”€â”€ Section: è¯é¢˜æ ‡ç­¾
â”‚   â”‚   â”œâ”€â”€ TopicChips.vue (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ Chip elements (click to copy)
â”‚   â”‚   â””â”€â”€ "ä¸€é”®å¤åˆ¶" button
â”‚   â”œâ”€â”€ Section: æ¨èæ ‡é¢˜
â”‚   â”‚   â””â”€â”€ TitleList.vue (NEW)
â”‚   â”‚       â””â”€â”€ TitleCard.vue (NEW, multiple)
â”‚   â”‚           â”œâ”€â”€ Title text
â”‚   â”‚           â”œâ”€â”€ "æ¨è" badge (first only)
â”‚   â”‚           â””â”€â”€ Copy button
â”‚   â””â”€â”€ RegenerateButton.vue (NEW)
â””â”€â”€ Action buttons (Download, Regenerate)
```

### Accumulated Context from Previous Stories

| Resource Type | Name | Source Story | Action | Key Info |
|--------------|------|--------------|--------|----------|
| API Endpoint | GET /api/v1/publish/tasks/{id}/assist | 5.3 | CONSUME | Returns { topics, titles, regenerate_remaining } |
| API Endpoint | POST /api/v1/publish/tasks/{id}/assist/regenerate | 5.3 | CONSUME | Regenerates content, returns same format |
| Error Code | 1031 | 5.3 | HANDLE | PUBLISH_ASSIST_LIMIT_EXCEEDED |
| View | VideoPreviewView | 5.1 | EXTEND | Add PublishAssistPanel integration |
| Composable Pattern | useVideoPlayer | 5.1 | FOLLOW | Composable state management pattern |
| Component Pattern | CollapsibleSection | 5.1 | REUSE (optional) | Collapsible UI pattern |
| Toast System | (TBD) | 1.3 or 5.4 | CREATE/REUSE | Notification feedback |

### API Request/Response Specifications

**GET /api/v1/publish/tasks/{id}/assist** (from Story 5.3)
```json
// Response 200
{
  "code": 0,
  "message": "success",
  "data": {
    "topics": [
      "#æµ·åº•æ",
      "#ç«é”…æ¢åº—",
      "#æœ›äº¬ç¾é£Ÿ",
      "#å¿…åƒæ¦œ",
      "#ç¾é£Ÿæ¨è",
      "#åƒè´§æ—¥å¸¸",
      "#æ¢åº—è¾¾äºº",
      "#åŒ—äº¬ç¾é£Ÿ"
    ],
    "titles": [
      "æœ›äº¬è¿™å®¶æµ·åº•æå¤ªç»äº†ï¼æœåŠ¡å¥½åˆ°è®©ä½ æ„ŸåŠ¨æµæ³ª",
      "äººå‡89åƒæµ·åº•æï¼Ÿè¿™ä¸ªå›¢è´­ä¹Ÿå¤ªé¦™äº†å§ï¼",
      "æµ·åº•ææ¢åº—ï½œå¿…ç‚¹æ‹›ç‰Œæ¯›è‚šï¼Œä¸ƒä¸Šå…«ä¸‹å¤ªå«©äº†",
      "æœ‹å‹èšé¤é¦–é€‰ï¼æœ›äº¬æµ·åº•ææ°›å›´æ„Ÿæ‹‰æ»¡"
    ],
    "regenerate_remaining": 3
  }
}

// Response 404 (task not found)
{
  "code": 40303,
  "message": "ä»»åŠ¡ä¸å­˜åœ¨"
}

// Response 400 (task not done)
{
  "code": 1025,
  "message": "è§†é¢‘å°šæœªå®Œæˆåˆæˆ"
}
```

**POST /api/v1/publish/tasks/{id}/assist/regenerate** (from Story 5.3)
```json
// Response 200 (same format as GET)

// Response 400 (limit exceeded)
{
  "code": 1031,
  "message": "å·²è¾¾åˆ°é‡æ–°ç”Ÿæˆæ¬¡æ•°ä¸Šé™ï¼ˆ3æ¬¡ï¼‰",
  "details": {
    "task_id": 12345,
    "regenerate_remaining": 0
  }
}
```

### Type Definitions

```typescript
// frontend/src/types/publish.ts

export interface PublishAssistResponse {
  topics: string[];
  titles: string[];
  regenerate_remaining: number;
}

// API response wrapper (matching project convention from Story 1.1)
export interface ApiResponse<T> {
  code: number;
  message: string;
  data: T;
}
```

### Composables Implementation Guide

**useClipboard.ts**
```typescript
export function useClipboard() {
  const copyToClipboard = async (text: string): Promise<boolean> => {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      // Fallback for older browsers
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      const success = document.execCommand('copy');
      document.body.removeChild(textarea);
      return success;
    } catch (error) {
      console.error('Clipboard copy failed:', error);
      return false;
    }
  };

  return { copyToClipboard };
}
```

**usePublishAssist.ts**
```typescript
export function usePublishAssist() {
  const topics = ref<string[]>([]);
  const titles = ref<string[]>([]);
  const regenerateRemaining = ref(3);
  const loading = ref(false);
  const error = ref<string | null>(null);

  const fetchPublishAssist = async (taskId: number) => {
    loading.value = true;
    error.value = null;
    try {
      const response = await getPublishAssist(taskId);
      topics.value = response.topics;
      titles.value = response.titles;
      regenerateRemaining.value = response.regenerate_remaining;
    } catch (e) {
      error.value = 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
    } finally {
      loading.value = false;
    }
  };

  const regenerate = async (taskId: number) => {
    // Similar implementation with regenerate API
  };

  return {
    topics,
    titles,
    regenerateRemaining,
    loading,
    error,
    fetchPublishAssist,
    regenerate,
  };
}
```

### File Locations Summary

| File | Action | Purpose |
|------|--------|---------|
| `frontend/src/api/publish.ts` | CREATE | Publish assist API calls |
| `frontend/src/types/publish.ts` | CREATE | Type definitions |
| `frontend/src/composables/useClipboard.ts` | CREATE | Clipboard copy utility |
| `frontend/src/composables/usePublishAssist.ts` | CREATE | Publish assist state management |
| `frontend/src/components/publish/TopicChips.vue` | CREATE | Topic tags display |
| `frontend/src/components/publish/TitleCard.vue` | CREATE | Single title card |
| `frontend/src/components/publish/TitleList.vue` | CREATE | Title list container |
| `frontend/src/components/publish/RegenerateButton.vue` | CREATE | Regenerate with remaining count |
| `frontend/src/components/publish/PublishAssistPanel.vue` | CREATE | Main panel container |
| `frontend/src/views/VideoPreviewView.vue` | MODIFY | Integrate PublishAssistPanel |
| `frontend/src/components/publish/__tests__/*.test.ts` | CREATE | Unit tests |

### Deliverable Bindings

> **SM**: Binding for each new code unit. Dev Gate will verify these.
> **Dev**: Ensure all bindings are implemented before self-review.

```yaml
deliverable_bindings:
  # API module
  - deliverable: "frontend/src/api/publish.ts"
    consumer: "frontend/src/composables/usePublishAssist.ts"
    binding_type: import
    verify: "getPublishAssist, regeneratePublishAssist"

  # Composables
  - deliverable: "frontend/src/composables/useClipboard.ts"
    consumer: "frontend/src/components/publish/TopicChips.vue"
    binding_type: import
    verify: "useClipboard"

  - deliverable: "frontend/src/composables/useClipboard.ts"
    consumer: "frontend/src/components/publish/TitleCard.vue"
    binding_type: import
    verify: "useClipboard"

  - deliverable: "frontend/src/composables/usePublishAssist.ts"
    consumer: "frontend/src/components/publish/PublishAssistPanel.vue"
    binding_type: import
    verify: "usePublishAssist"

  # Component composition
  - deliverable: "frontend/src/components/publish/TopicChips.vue"
    consumer: "frontend/src/components/publish/PublishAssistPanel.vue"
    binding_type: vue_component
    verify: "<TopicChips"

  - deliverable: "frontend/src/components/publish/TitleCard.vue"
    consumer: "frontend/src/components/publish/TitleList.vue"
    binding_type: vue_component
    verify: "<TitleCard"

  - deliverable: "frontend/src/components/publish/TitleList.vue"
    consumer: "frontend/src/components/publish/PublishAssistPanel.vue"
    binding_type: vue_component
    verify: "<TitleList"

  - deliverable: "frontend/src/components/publish/RegenerateButton.vue"
    consumer: "frontend/src/components/publish/PublishAssistPanel.vue"
    binding_type: vue_component
    verify: "<RegenerateButton"

  # View integration
  - deliverable: "frontend/src/components/publish/PublishAssistPanel.vue"
    consumer: "frontend/src/views/VideoPreviewView.vue"
    binding_type: vue_component
    verify: "<PublishAssistPanel"
```

**Binding Status**: âœ… Verified by Dev

### Testing Requirements

- **å•å…ƒæµ‹è¯•é‡ç‚¹** (Vitest + Vue Test Utils):
  - TopicChips: render, click copy, copyAll, empty state
  - TitleCard: render, copy button, recommended badge
  - TitleList: render all, first is recommended
  - RegenerateButton: states (normal, loading, disabled)
  - PublishAssistPanel: mount fetches data, regenerate flow
  - useClipboard: success/failure paths
  - usePublishAssist: fetch, regenerate, error handling

- **é›†æˆæµ‹è¯•é‡ç‚¹**:
  - API mock with MSW
  - Full panel render with data
  - Error state recovery

- **è¾¹ç•Œæµ‹è¯•**:
  - Clipboard API not supported
  - Network failures
  - Empty data responses

---

## AC Traceability Matrix

> **Dev**: Fill this section BEFORE self-review. Every AC needs evidence.
> **QA**: Verify each entry during AC Coverage Verification.

### AC1: è¯é¢˜æ ‡ç­¾å±•ç¤ºä¸å¤åˆ¶

```yaml
ac_id: AC1
code_locations:
  - "frontend/src/components/publish/TopicChips.vue"
  - "frontend/src/composables/useClipboard.ts"
test_locations:
  - "frontend/src/components/publish/__tests__/TopicChips.test.ts"
verification_type: unit_test
aspects_covered:
  main_scenario: true
  business_rules: true
  data_validation: true
  error_handling: true
notes: "Chip-style topics, click-to-copy, copyAll button"
```

### AC2: æ ‡é¢˜æ¨èå±•ç¤ºä¸å¤åˆ¶

```yaml
ac_id: AC2
code_locations:
  - "frontend/src/components/publish/TitleList.vue"
  - "frontend/src/components/publish/TitleCard.vue"
test_locations:
  - "frontend/src/components/publish/__tests__/TitleList.test.ts"
verification_type: unit_test
aspects_covered:
  main_scenario: true
  business_rules: true
  data_validation: true
  error_handling: true
notes: "Card-style titles, copy button, recommended badge on first"
```

### AC3: é‡æ–°ç”ŸæˆUI

```yaml
ac_id: AC3
code_locations:
  - "frontend/src/components/publish/PublishAssistPanel.vue"
  - "frontend/src/components/publish/RegenerateButton.vue"
  - "frontend/src/composables/usePublishAssist.ts"
test_locations:
  - "frontend/src/components/publish/__tests__/PublishAssistPanel.test.ts"
verification_type: unit_test
aspects_covered:
  main_scenario: true
  business_rules: true
  data_validation: true
  error_handling: true
notes: "Regenerate button with remaining count, loading/disabled states"
```

---

### Traceability Summary

| AC | Code Location | Test Location | Type | Status |
|----|---------------|---------------|------|--------|
| AC1 | TopicChips.vue, useClipboard.ts | TopicChips.test.ts | unit | âœ… |
| AC2 | TitleList.vue, TitleCard.vue | TitleList.test.ts | unit | âœ… |
| AC3 | PublishAssistPanel.vue, RegenerateButton.vue, usePublishAssist.ts | PublishAssistPanel.test.ts | unit | âœ… |

**Legend**: âœ… Verified | â³ Pending | âŒ Missing

---

## Architect Review Results

### Review Date: 2026-02-05
### Reviewed By: Aiden (Architect Agent)
### Architecture Score: 10.0/10
### Review Round: 1

### Decision: Approved

### Summary

Story fully aligns with frontend architecture:

| Validation | Reference | Status |
|------------|-----------|--------|
| Directory structure | Â§12.1 Code Organization | âœ… api/, composables/, components/ |
| API path | Story 5.3 backend | âœ… /api/v1/publish/tasks/{id}/assist |
| Component naming | Vue 3 conventions | âœ… PascalCase |
| Composables naming | Vue 3 conventions | âœ… use* prefix |
| Integration point | VideoPreviewView.vue | âœ… Exists from Story 5.1 |
| Testing strategy | Â§12.4 | âœ… Vitest + Vue Test Utils |

### Issues

None - Story is well-structured and architecturally compliant.

### Recommendations

- Story ready for development (Simple tier - no QA test design required)

---

## QA Test Design Metadata

| Field | Value |
|-------|-------|
| test_design_level | Simple |
| complexity_indicators | 1 |
| security_sensitive | false |
| calculated_by | Architect (review) |
| calculation_date | 2026-02-05 |

---

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-22 | SM | Created â†’ Draft | Story created from PRD Epic 5 |
| 2026-02-05 | SM | Draft â†’ AwaitingArchReview | Full elaboration: TopicChips, TitleList, PublishAssistPanel components, useClipboard/usePublishAssist composables, API module, integration with VideoPreviewView. Corrected API path to /api/v1/publish/tasks/{id}/assist per Story 5.3. |
| 2026-02-05 16:00 | Architect | AwaitingArchReview â†’ Approved | Score: 10.0/10, No issues. Simple tier - ready for Dev implementation |
| 2026-02-06 | Dev | Approved â†’ Review | Implementation complete: TopicChips, TitleList, TitleCard, RegenerateButton, PublishAssistPanel components; useClipboard, usePublishAssist composables; API module; 44 unit tests. See dev log 5.4-dev-log.md |
