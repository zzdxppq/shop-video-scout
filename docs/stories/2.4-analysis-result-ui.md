# Story 2.4: åˆ†æè¿›åº¦å±•ç¤ºé¡µé¢

## Status
Done

## Story

**As a** ç”¨æˆ·,
**I want** åœ¨AIåˆ†æè¿‡ç¨‹ä¸­æŸ¥çœ‹å®æ—¶è¿›åº¦å’Œå¤„ç†é˜¶æ®µ,
**so that** å¯ä»¥äº†è§£å¤„ç†è¿›å±•å¹¶åœ¨å®Œæˆåè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥

## Acceptance Criteria

### AC1: åˆ†æè¿›åº¦å±•ç¤º

**Scenario**
```gherkin
GIVEN ç”¨æˆ·ç‚¹å‡»"å¼€å§‹AIåˆ†æ"æŒ‰é’®
WHEN AIåˆ†æè¿›è¡Œä¸­
THEN
  - æ˜¾ç¤ºæ•´ä½“è¿›åº¦æ¡å’Œç™¾åˆ†æ¯”
  - æ˜¾ç¤º"å·²åˆ†æ X/Y ä¸ªè§†é¢‘"æ–‡æœ¬
  - æ˜¾ç¤ºé¢„è®¡å‰©ä½™æ—¶é—´
  - æ˜¾ç¤ºå½“å‰å¤„ç†é˜¶æ®µåˆ—è¡¨ï¼ˆå«çŠ¶æ€æ ‡è®°ï¼‰
  - åˆ†æå®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°è„šæœ¬ç¼–è¾‘é¡µ
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | æ¯2ç§’è½®è¯¢ä¸€æ¬¡è¿›åº¦æ¥å£ `GET /api/v1/tasks/{id}/progress` |
| BR-1.2 | å¤„ç†é˜¶æ®µä¾æ¬¡æ˜¾ç¤ºï¼šä¸Šä¼ å®Œæˆ âœ“ â†’ é•œå¤´å†…å®¹è¯†åˆ« â†’ ç”»é¢è´¨é‡è¯„ä¼° â†’ æ¨èé•œå¤´æ ‡è®° â†’ è„šæœ¬ç”Ÿæˆ |
| BR-1.3 | è¿›åº¦æ¡åŠ¨ç”»å¹³æ»‘è¿‡æ¸¡ï¼Œä½¿ç”¨ linear easingï¼Œ100ms æ›´æ–°é—´éš” |
| BR-1.4 | åˆ†æå®Œæˆåæ˜¾ç¤ºå®ŒæˆåŠ¨ç”»ï¼Œ2ç§’åè‡ªåŠ¨è·³è½¬ |
| BR-1.5 | åˆ†æä¸­ç¦æ­¢é¡µé¢ç¦»å¼€ï¼ˆbeforeunload æç¤ºï¼‰ |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| åˆ†æå¤±è´¥ | ANALYSIS_ERROR | åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯• | æ˜¾ç¤ºé‡è¯•æŒ‰é’®ï¼Œç‚¹å‡»é‡æ–°è§¦å‘åˆ†æ |
| è½®è¯¢è¶…æ—¶ | POLL_TIMEOUT | ç½‘ç»œä¸ç¨³å®šï¼Œæ­£åœ¨é‡è¯• | è‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œå¤±è´¥åæ˜¾ç¤ºåˆ·æ–°æŒ‰é’® |
| åˆ†ææ—¶é—´è¿‡é•¿ | LONG_WAIT | åˆ†ææ—¶é—´è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾… | è¶…è¿‡3åˆ†é’Ÿæ˜¾ç¤ºæ­¤æç¤ºï¼Œ5åˆ†é’Ÿæ˜¾ç¤ºé‡è¯•é€‰é¡¹ |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| é¡µé¢åŠ è½½ | ç«‹å³å¼€å§‹è½®è¯¢è¿›åº¦ï¼Œæ˜¾ç¤ºè¿›åº¦ç»„ä»¶ |
| è¿›åº¦æ›´æ–° | è¿›åº¦æ¡å¹³æ»‘åŠ¨ç”»æ›´æ–°ï¼Œé˜¶æ®µçŠ¶æ€å®æ—¶åˆ‡æ¢ |
| åˆ†æå®Œæˆ | æ˜¾ç¤º"âœ“ åˆ†æå®Œæˆ"åŠ¨ç”»ï¼Œ2ç§’åè·³è½¬åˆ° `/task/:id` (è„šæœ¬ç¼–è¾‘æ­¥éª¤) |
| ç‚¹å‡»é‡è¯• | é‡æ–°è°ƒç”¨ `POST /api/v1/tasks/{id}/analyze`ï¼Œé‡ç½®è¿›åº¦ |

---

### AC2: é•œå¤´åˆ†ç±»ç»“æœå±•ç¤º

**Scenario**
```gherkin
GIVEN AIåˆ†æå®Œæˆ
WHEN ç”¨æˆ·æŸ¥çœ‹åˆ†æç»“æœ
THEN
  - æŒ‰åˆ†ç±»Tabå±•ç¤ºé•œå¤´ï¼ˆå…¨éƒ¨/é£Ÿç‰©/äººç‰©/ç¯å¢ƒ/å…¶ä»–ï¼‰
  - æ¯ä¸ªé•œå¤´æ˜¾ç¤ºç¼©ç•¥å›¾ã€åˆ†ç±»æ ‡ç­¾ã€è´¨é‡è¯„åˆ†
  - æ¨èé•œå¤´æ˜¾ç¤ºæ˜Ÿæ ‡(â­)ç‰¹æ®Šæ ‡è®°
  - æ”¯æŒTabåˆ‡æ¢å’Œé•œå¤´é¢„è§ˆ
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-2.1 | é»˜è®¤å±•ç¤º"å…¨éƒ¨"Tabï¼Œæ˜¾ç¤ºæ‰€æœ‰å·²åˆ†æé•œå¤´ |
| BR-2.2 | æ¨èé•œå¤´(is_recommended=true)æ˜¾ç¤ºâ­æ˜Ÿæ ‡ |
| BR-2.3 | è´¨é‡è¯„åˆ†ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ¨ç¼©ç•¥å›¾å³ä¸‹è§’ |
| BR-2.4 | Tabæ ‡ç­¾æ˜¾ç¤ºè¯¥åˆ†ç±»ä¸‹çš„é•œå¤´æ•°é‡ï¼Œå¦‚"é£Ÿç‰©(12)" |

**Error Handling**
| Scenario | Code | Message | Action |
|----------|------|---------|--------|
| æ— åˆ†æç»“æœ | NO_RESULTS | æš‚æ— åˆ†æç»“æœ | æ˜¾ç¤ºç©ºçŠ¶æ€ï¼Œå¼•å¯¼ç”¨æˆ·é‡æ–°ä¸Šä¼  |
| ç¼©ç•¥å›¾åŠ è½½å¤±è´¥ | IMG_ERROR | - | æ˜¾ç¤ºå ä½å›¾ï¼Œä¸å½±å“åŠŸèƒ½ |

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| ç‚¹å‡»Tab | åˆ‡æ¢æ˜¾ç¤ºå¯¹åº”åˆ†ç±»çš„é•œå¤´åˆ—è¡¨ |
| æ‚¬åœç¼©ç•¥å›¾ | æ˜¾ç¤ºé•œå¤´è¯¦ç»†ä¿¡æ¯tooltipï¼ˆæ ‡ç­¾ã€æè¿°ï¼‰ |
| ç‚¹å‡»ç¼©ç•¥å›¾ | å¼¹å‡ºé•œå¤´é¢„è§ˆModalï¼Œæ˜¾ç¤ºå¤§å›¾å’Œè¯¦ç»†ä¿¡æ¯ |

---

## Tasks / Subtasks

### Infrastructure Tasks (Shared)

- [x] **T0: ç»„ä»¶å’Œè·¯ç”±è®¾ç½®** `[ALL ACs]`
  - [x] åœ¨ `frontend/src/views/` åˆ›å»º `TaskAnalysisView.vue` ç»„ä»¶
  - [x] åœ¨ `frontend/src/router/index.ts` æ³¨å†Œè·¯ç”±ï¼ˆå¤ç”¨ `/task/:id`ï¼Œæ ¹æ® task.status æ˜¾ç¤ºä¸åŒå†…å®¹ï¼‰
  - [x] åˆ›å»º Pinia store `useAnalysisStore` ç®¡ç†åˆ†æçŠ¶æ€

### Feature Implementation Tasks

- [x] **T1: å®ç°åˆ†æè¿›åº¦å±•ç¤ºç»„ä»¶** `[AC1]`

  **Test Specs**:
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | è¿›åº¦æ¡æ¸²æŸ“ | progress=65 | æ˜¾ç¤º65%è¿›åº¦æ¡ | unit |
  | é˜¶æ®µçŠ¶æ€æ˜¾ç¤º | stagesæ•°ç»„ | æ­£ç¡®æ¸²æŸ“âœ“/â—/â—‹çŠ¶æ€ | unit |
  | è½®è¯¢å¯åŠ¨ | ç»„ä»¶æŒ‚è½½ | 2ç§’é—´éš”è°ƒç”¨API | integration |
  | å®Œæˆè·³è½¬ | status=completed | 2ç§’åè·¯ç”±è·³è½¬ | integration |
  | ç¦»å¼€æ‹¦æˆª | beforeunload | æ˜¾ç¤ºç¡®è®¤æç¤º | e2e |

  - [x] Write unit tests for ProgressOverlay component
  - [x] Implement `AnalysisProgress.vue` component
  - [x] Implement progress polling composable `useProgressPolling`
  - [x] Add beforeunload handler
  - [x] Verify all tests pass

- [x] **T2: å®ç°é•œå¤´åˆ†ç±»å±•ç¤ºç»„ä»¶** `[AC2]`

  **Test Specs**:
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | Tabæ¸²æŸ“ | categories | æ˜¾ç¤º5ä¸ªTab+æ•°é‡ | unit |
  | Tabåˆ‡æ¢ | clické£Ÿç‰©Tab | ä»…æ˜¾ç¤ºfoodç±»é•œå¤´ | unit |
  | æ¨èæ ‡è®° | is_recommended=true | æ˜¾ç¤ºâ­å›¾æ ‡ | unit |
  | ç©ºçŠ¶æ€ | frames=[] | æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º | unit |
  | ç¼©ç•¥å›¾hover | mouseenter | æ˜¾ç¤ºtooltip | integration |

  - [x] Write unit tests for FrameGallery component
  - [x] Implement `FrameGallery.vue` with Tab filtering
  - [x] Implement `FrameCard.vue` for individual frame display (integrated in FrameGallery)
  - [x] Implement frame preview Modal
  - [x] Verify all tests pass

- [x] **T3: APIé›†æˆä¸çŠ¶æ€ç®¡ç†** `[ALL ACs]`

  **Test Specs**:
  | Scenario | Input | Expected | Level |
  |----------|-------|----------|-------|
  | è·å–è¿›åº¦ | taskId | è¿”å›progresså¯¹è±¡ | integration |
  | è½®è¯¢é‡è¯• | ç½‘ç»œå¤±è´¥ | é‡è¯•3æ¬¡ | integration |
  | é”™è¯¯å¤„ç† | 500 response | æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ | unit |
  | Storeæ›´æ–° | APIå“åº” | StoreçŠ¶æ€æ­£ç¡®æ›´æ–° | unit |

  - [x] Write tests for API client methods
  - [x] Implement `frontend/src/api/analysis.ts` API client
  - [x] Implement `useAnalysisStore` Pinia store
  - [x] Integrate with existing task flow
  - [x] Verify all tests pass

### Integration & Verification Tasks

- [x] **T4: Integration Testing** `[ALL ACs]`
  - [x] End-to-end progress flow test (start â†’ complete â†’ redirect)
  - [x] Tab filtering integration test
  - [x] Error recovery flow test

- [x] **T5: Final Verification** `[ALL ACs]`
  - [x] All tests passing (unit + integration) - 211 tests passing
  - [x] No lint errors - TypeScript compilation passes
  - [x] Dev Log complete with implementation summary
  - [x] Status â†’ Review

## AC Coverage Matrix

| Task | AC1 | AC2 |
|------|:---:|:---:|
| T0: Infrastructure | âœ“ | âœ“ |
| T1: Progress Display | âœ“ |   |
| T2: Frame Gallery |   | âœ“ |
| T3: API Integration | âœ“ | âœ“ |
| T4: Integration | âœ“ | âœ“ |
| T5: Final | âœ“ | âœ“ |

---

## Dev Notes

### Technical Constraints

- è½®è¯¢é—´éš”å›ºå®š2ç§’ï¼Œä½¿ç”¨ `setInterval` + cleanup on unmount
- è¿›åº¦åŠ¨ç”»ä½¿ç”¨ CSS transitionï¼Œé¿å… JS åŠ¨ç”»é€ æˆæ€§èƒ½é—®é¢˜
- beforeunload ä»…åœ¨åˆ†æè¿›è¡Œä¸­æ¿€æ´»ï¼Œå®Œæˆåç§»é™¤
- [â†’ docs/architecture/12-development-guidelines.md#12.4 Testing Strategy]

### ğŸ“ UI/UX Specification Reference

**Reference File**: `docs/front-end-spec.md`

| Section | Why Relevant |
|---------|--------------|
| Section 5.4 (Wireframe - AIåˆ†æè¿›åº¦) | é¡µé¢å¸ƒå±€å’Œè§†è§‰è®¾è®¡å‚è€ƒ |
| Section 4.1 (Main Flow) | è¿›åº¦å±•ç¤ºçš„ç”¨æˆ·æµç¨‹å’Œæ—¶é—´é¢„ç®— (AIåˆ†æ~3åˆ†é’Ÿ) |
| Section 6.2 (ProgressOverlay Component) | ç»„ä»¶è§„æ ¼ï¼šstates = active/complete/error |
| Section 10.2 (Progress Bar Animation) | åŠ¨ç”»è§„æ ¼ï¼š100ms, linear easing |
| Section 3.4 (Page State Mapping) | `/task/:id` çŠ¶æ€ï¼šAnalyzing â†’ Script Ready |

### Accumulated Context (From Previous Stories)

| Resource Type | Name | Source Story | Action | Key Info |
|--------------|------|--------------|--------|----------|
| Table | tasks | 1.1 | REUSE | status å­—æ®µè¿½è¸ªä»»åŠ¡çŠ¶æ€ (analyzing â†’ script_ready) |
| Table | videos | 1.1 | REUSE | è·å–è§†é¢‘æ€»æ•°ç”¨äºè¿›åº¦æ˜¾ç¤º |
| Table | video_frames | 1.1 | REUSE | è·å–åˆ†æç»“æœ (category, quality_score, is_recommended) |
| Endpoint | GET /api/v1/tasks/{id}/progress | 2.3 | CALL | è¿”å› {percent, current_video, total_videos, stage, stages[]} |
| Endpoint | POST /api/v1/tasks/{id}/analyze | 2.3 | CALL (retry) | é‡æ–°è§¦å‘åˆ†æ |

### Data Models

**Progress Response Interface** (from Story 2.3 API):
```typescript
interface AnalysisProgress {
  percent: number;           // 0-100
  currentVideo: number;      // å½“å‰å¤„ç†çš„è§†é¢‘åºå·
  totalVideos: number;       // è§†é¢‘æ€»æ•°
  stage: string;             // å½“å‰é˜¶æ®µæ ‡è¯†
  stages: Array<{
    id: string;
    label: string;
    status: 'pending' | 'in_progress' | 'completed';
  }>;
  estimatedTimeRemaining: number; // ç§’
  status: 'analyzing' | 'completed' | 'failed';
  error?: string;
}

interface VideoFrame {
  id: number;
  videoId: number;
  thumbnailUrl: string;
  category: 'food' | 'person' | 'environment' | 'other';
  tags: string[];
  qualityScore: number;
  isRecommended: boolean;
}
```

### File Locations

| File | Purpose | Action |
|------|---------|--------|
| `frontend/src/views/TaskAnalysisView.vue` | åˆ†æè¿›åº¦ä¸»é¡µé¢ | CREATE |
| `frontend/src/components/analysis/AnalysisProgress.vue` | è¿›åº¦å±•ç¤ºç»„ä»¶ | CREATE |
| `frontend/src/components/analysis/FrameGallery.vue` | é•œå¤´åˆ†ç±»å±•ç¤ºç»„ä»¶ | CREATE |
| `frontend/src/components/analysis/FrameCard.vue` | å•ä¸ªé•œå¤´å¡ç‰‡ç»„ä»¶ | CREATE |
| `frontend/src/composables/useProgressPolling.ts` | è¿›åº¦è½®è¯¢composable | CREATE |
| `frontend/src/stores/analysis.ts` | åˆ†æçŠ¶æ€Pinia store | CREATE |
| `frontend/src/api/analysis.ts` | åˆ†æç›¸å…³APIå®¢æˆ·ç«¯ | CREATE |
| `frontend/src/router/index.ts` | è·¯ç”±é…ç½® | MODIFY (add route guard) |

### Deliverable Bindings

```yaml
deliverable_bindings:
  - deliverable: "frontend/src/views/TaskAnalysisView.vue"
    consumer: "frontend/src/router/index.ts"
    binding_type: route_mount
    verify: "path.*task.*:id.*component.*TaskAnalysis"

  - deliverable: "frontend/src/components/analysis/AnalysisProgress.vue"
    consumer: "frontend/src/views/TaskAnalysisView.vue"
    binding_type: import_usage
    verify: "import.*AnalysisProgress"

  - deliverable: "frontend/src/components/analysis/FrameGallery.vue"
    consumer: "frontend/src/views/TaskAnalysisView.vue"
    binding_type: import_usage
    verify: "import.*FrameGallery"

  - deliverable: "frontend/src/stores/analysis.ts"
    consumer: "frontend/src/views/TaskAnalysisView.vue"
    binding_type: import_usage
    verify: "useAnalysisStore"

  - deliverable: "frontend/src/api/analysis.ts"
    consumer: "frontend/src/stores/analysis.ts"
    binding_type: import_usage
    verify: "import.*from.*api/analysis"

  - deliverable: "frontend/src/composables/useProgressPolling.ts"
    consumer: "frontend/src/views/TaskAnalysisView.vue"
    binding_type: import_usage
    verify: "useProgressPolling"
```

**Binding Status**: â³ Pending Dev verification

### Testing Requirements

- **Unit Tests**: ProgressOverlay states, FrameCard rendering, Tab filtering logic
- **Integration Tests**: Polling lifecycle (start/stop/retry), Store-API integration
- **E2E Tests**: Full analysis flow from start to redirect
- **Focus Areas**:
  - Polling cleanup on component unmount (memory leak prevention)
  - Progress animation smoothness (no janky updates)
  - Error recovery UX (retry button visibility)

---

## AC Traceability Matrix

> **Dev**: Fill this section BEFORE self-review. Every AC needs evidence.
> **QA**: Verify each entry during AC Coverage Verification.

### AC1: åˆ†æè¿›åº¦å±•ç¤º

```yaml
ac_id: AC1
code_locations:
  - "frontend/src/components/analysis/AnalysisProgress.vue:1-200"
  - "frontend/src/composables/useProgressPolling.ts:1-150"
  - "frontend/src/stores/analysis.ts:1-100"
  - "frontend/src/views/TaskAnalysisView.vue:1-250"
test_locations:
  - "frontend/src/components/analysis/__tests__/AnalysisProgress.spec.ts:all"
  - "frontend/src/stores/__tests__/analysis.spec.ts:all"
verification_type: unit_test
aspects_covered:
  main_scenario: true
  business_rules: true  # BR-1.1, BR-1.2, BR-1.3, BR-1.4, BR-1.5
  data_validation: true
  error_handling: true  # ANALYSIS_ERROR, POLL_TIMEOUT, LONG_WAIT
notes: "23 unit tests passing, covers progress bar, stages, time display, completion, error states"
```

### AC2: é•œå¤´åˆ†ç±»ç»“æœå±•ç¤º

```yaml
ac_id: AC2
code_locations:
  - "frontend/src/components/analysis/FrameGallery.vue:1-200"
  - "frontend/src/stores/analysis.ts:45-75"  # filteredFrames, tabs computed
  - "frontend/src/types/analysis.ts:40-75"  # VideoFrame, FrameTab types
test_locations:
  - "frontend/src/components/analysis/__tests__/FrameGallery.spec.ts:all"
  - "frontend/src/stores/__tests__/analysis.spec.ts:filteredFrames,tabs"
verification_type: unit_test
aspects_covered:
  main_scenario: true
  business_rules: true  # BR-2.1, BR-2.2, BR-2.3, BR-2.4
  data_validation: true
  error_handling: true  # NO_RESULTS, IMG_ERROR
notes: "18 unit tests passing, covers tabs, filtering, quality score, recommended markers, empty state"
```

---

### Traceability Summary

| AC | Code Location | Test Location | Type | Status |
|----|---------------|---------------|------|--------|
| AC1 | AnalysisProgress.vue, useProgressPolling.ts | AnalysisProgress.spec.ts | unit | âœ… |
| AC2 | FrameGallery.vue, analysis.ts | FrameGallery.spec.ts | unit | âœ… |

**Legend**: âœ… Verified | â³ Pending | âŒ Missing

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### Implementation Summary
Implemented the Analysis Progress Display page (Story 2.4) with:

**AC1 - Progress Display:**
- `AnalysisProgress.vue` component showing progress bar, video count, estimated time, and stage markers
- `useProgressPolling` composable with 2-second polling interval (BR-1.1)
- Stage status markers (âœ“/â—/â—‹) following BR-1.2
- CSS transition for smooth animation (BR-1.3: 100ms linear)
- Auto-redirect after 2-second completion animation (BR-1.4)
- beforeunload handler to prevent accidental navigation (BR-1.5)
- Error state with retry button
- Long wait warnings at 3min and 5min

**AC2 - Frame Gallery:**
- `FrameGallery.vue` component with 5 category tabs (å…¨éƒ¨/é£Ÿç‰©/äººç‰©/ç¯å¢ƒ/å…¶ä»–)
- Tab counts showing frame numbers (BR-2.4)
- Quality score positioned at thumbnail bottom-right (BR-2.3)
- Star marker (â­) for recommended frames (BR-2.2)
- Default "å…¨éƒ¨" tab selection (BR-2.1)
- Empty state with guidance message
- Image error fallback handling
- Preview modal for frame details

**Infrastructure:**
- `useAnalysisStore` Pinia store for state management
- TypeScript types in `types/analysis.ts`
- API client in `api/analysis.ts`
- Route added at `/task/:id`

### Database Changes (Structured)
```yaml
{}
# No database changes - frontend-only story
```

### API Endpoints Created (Structured)
```yaml
[]
# No new endpoints - consumes existing endpoints from Story 2.3:
# - GET /api/v1/tasks/{id}/progress
# - POST /api/v1/tasks/{id}/analyze
# - GET /api/v1/tasks/{id}/frames
```

### Shared Models Created (Structured)
```yaml
typescript_interfaces:
  - name: AnalysisProgress
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: VideoFrame
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: AnalysisStage
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: FrameTab
    file: frontend/src/types/analysis.ts
    story: "2.4"
types:
  - name: StageStatus
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: AnalysisStatus
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: FrameCategory
    file: frontend/src/types/analysis.ts
    story: "2.4"
  - name: TabCategory
    file: frontend/src/types/analysis.ts
    story: "2.4"
constants:
  - name: POLLING_INTERVAL_MS
    value: 2000
    story: "2.4"
  - name: REDIRECT_DELAY_MS
    value: 2000
    story: "2.4"
```

### File List
| File | Action | Lines |
|------|--------|-------|
| frontend/src/types/analysis.ts | CREATE | 95 |
| frontend/src/api/analysis.ts | CREATE | 35 |
| frontend/src/stores/analysis.ts | CREATE | 95 |
| frontend/src/composables/useProgressPolling.ts | CREATE | 150 |
| frontend/src/components/analysis/AnalysisProgress.vue | CREATE | 285 |
| frontend/src/components/analysis/FrameGallery.vue | CREATE | 215 |
| frontend/src/views/TaskAnalysisView.vue | CREATE | 285 |
| frontend/src/router/index.ts | MODIFY | +6 |
| frontend/src/components/analysis/__tests__/AnalysisProgress.spec.ts | CREATE | 270 |
| frontend/src/components/analysis/__tests__/FrameGallery.spec.ts | CREATE | 230 |
| frontend/src/stores/__tests__/analysis.spec.ts | CREATE | 145 |

### Dev Log Reference
`docs/dev/logs/2.4-dev-log.md`

### Open Issues
None

---

## QA Results

- **Round**: 1
- **Risk Level**: MEDIUM
- **Review Mode**: automated_plus_spot_check
- **Gate**: PASS
- **Tests**: 211/211 automated (100%)
- **AC Coverage**: 2/2 ACs verified (100%)
- **Blind Spots**: 6/8 covered (75%)
- **Issues**: 0 critical / 0 high / 2 medium
- **Gate File**: `docs/qa/gates/2.4-analysis-result-ui.yml`

### QA Notes
- All business rules (BR-1.1 through BR-2.4) verified in code
- 53 new tests added for this story (23 + 18 + 12)
- Minor gap: 2 blind spot scenarios have code coverage but missing explicit tests (ERROR-003, FLOW-002)
- Deviation noted: FrameCard integrated into FrameGallery (acceptable simplification)

---

## QA Test Design Metadata

| Field | Value |
|-------|-------|
| test_design_level | Standard |
| test_design_status | Complete |
| complexity_indicators | 1 |
| security_sensitive | false |
| calculated_by | QA (JW) |
| calculation_date | 2026-01-23 |
| test_design_doc | docs/qa/assessments/2.4-test-design-20260123.md |
| scenarios_total | 32 (Unit: 14, Integration: 8, E2E: 4) |
| blind_spot_scenarios | 6 |

---

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-23 | SM | Re-created â†’ Draft | Story re-drafted with complete template, UI/UX refs, deliverable bindings |
| 2026-01-23 | SM | Draft â†’ AwaitingTestDesign | Quality: 8.5/10, Complexity: 1/7, Arch Review: NOT_REQUIRED, Test Design: Standard |
| 2026-01-23 | QA | AwaitingTestDesign â†’ Approved | Test Design Complete: 32 scenarios (P0:6, P1:16, P2:8, P3:2), 6 blind spots |
| 2026-01-25 | Dev | Approved â†’ Review | Implementation complete: 211 tests passing, AC1/AC2 verified, ready for QA |
| 2026-01-25 | QA | Review â†’ Done | Round 1, Gate: PASS, Tests: 211/211 (100%), AC Coverage: 100% |
