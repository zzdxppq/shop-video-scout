# Story 8.2: AI生成视频标题建议

## Status
AwaitingTestDesign

## Story

**As a** 用户,
**I want** 系统为我的视频提供吸引眼球的标题建议,
**so that** 可以选择一个直接复制使用或作为参考

## Description

实现AI视频标题建议功能：
- 生成3-5个标题选项
- 标题风格符合抖音/小红书爆款特征
- 支持复制使用

## Acceptance Criteria

### AC1: 标题生成

**Scenario**
```gherkin
GIVEN 视频合成完成
WHEN 用户查看发布辅助页面
THEN
  - 显示3-5个标题建议
  - 标题风格多样化
  - 长度控制在20-50字
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | 生成3-5个标题 |
| BR-1.2 | 长度: 20-50字 |
| BR-1.3 | 风格: 悬念式、数字式、情感式等 |
| BR-1.4 | 突出店铺亮点和优惠 |

### AC2: 标题复制

**Scenario**
```gherkin
GIVEN 用户看到标题建议
WHEN 点击某个标题
THEN
  - 复制该标题到剪贴板
  - 显示复制成功提示
```

**UI Interaction**
| Trigger | Behavior |
|---------|----------|
| 点击标题卡片 | 复制标题内容 |
| 复制后 | 显示"已复制"提示并高亮 |

### AC3: 标题存储

**Scenario**
```gherkin
GIVEN 标题已生成
WHEN 用户下次访问
THEN
  - 显示之前生成的标题
  - 记录用户选中的标题
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-3.1 | 标题存储在 task_publish_assists.title_suggestions |
| BR-3.2 | 记录用户最终选择 |

## Tasks / Subtasks

## Infrastructure Tasks (Shared)

- [ ] **T0: 复用基础设施** `[ALL ACs]`
  - [ ] 使用E8.1创建的表和服务

## Feature Implementation Tasks

### AC1: 标题生成

- [ ] **T1: 实现标题生成** `[AC1]`
  - [ ] 创建 TitleService
  - [ ] 设计标题生成Prompt
  - [ ] 调用豆包API
  - [ ] 解析并存储结果
  - [ ] 编写单元测试

### AC2: 标题复制

- [ ] **T2: 实现复制功能** `[AC2]`
  - [ ] 创建 TitleSuggestions.vue 组件
  - [ ] 实现点击复制
  - [ ] 显示复制提示
  - [ ] 编写测试

### AC3: 标题存储

- [ ] **T3: 实现标题存储** `[AC3]`
  - [ ] 扩展 /tasks/{id}/publish-assist 接口
  - [ ] 支持记录用户选择
  - [ ] 编写测试

## Integration & Verification Tasks

- [ ] **T4: 集成测试** `[ALL ACs]`
  - [ ] 端到端: 视频完成→标题生成→复制
  - [ ] 不同店铺类型测试

## Dev Notes

### Technical Constraints

- 复用ai-service的豆包调用
- 与话题推荐一起返回

### Title Generation Prompt

```
为以下探店视频生成5个吸引眼球的标题：

店铺: {shop_name} ({shop_type})
脚本摘要: {script_summary}
优惠信息: {promotion}

要求：
1. 长度20-50字
2. 符合抖音/小红书爆款风格
3. 风格多样：悬念式、数字式、情感式、对比式、疑问式
4. 突出亮点和优惠
5. 可包含emoji

返回JSON数组:
["标题1", "标题2", "标题3", "标题4", "标题5"]
```

### Example Titles

```json
[
  "🔥重庆最火的火锅店！人均50吃到撑，本地人都排队",
  "在重庆吃了30年火锅，这家店让我重新认识了什么叫正宗",
  "朋友带我去的宝藏火锅店，菜品新鲜到没话说！",
  "重庆探店｜这家店的毛肚7秒就能吃，太绝了！",
  "人均50的火锅自助？味道居然这么绝！"
]
```

### API Response

```json
{
  "hot_topics": ["#美食探店#", ...],
  "title_suggestions": [
    "🔥重庆最火的火锅店！人均50吃到撑",
    "在重庆吃了30年火锅，这家让我惊艳",
    "朋友带我去的宝藏火锅店，必吃！",
    "重庆探店｜毛肚7秒就能吃，太绝了",
    "人均50的火锅？味道居然这么绝！"
  ],
  "selected_title": null
}
```

### File Locations

```
backend/publish-service/
├── src/main/java/
│   └── service/
│       └── TitleService.java

frontend/
├── src/components/
│   └── TitleSuggestions.vue
```

## Source Proposals
- TCP-2026-001 Story Requirement T9
- PCP-2026-001 Story Requirement 7

## Architect Review Results

### Review Date: 2026-01-14
### Reviewed By: Aiden (Architect)
### Architecture Score: 9.7/10
### Review Round: 1
### Test Design Level: Standard

### Decision: APPROVED (Pending Test Design)

Story与TCP-2026-001高度对齐。复用E8.1创建的task_publish_assists表和publish-service服务，设计合理高效。Prompt在TCP基础上增强了风格多样性要求（悬念式、数字式等），为合理增强。由于涉及AI生成内容质量验证，需要QA进行测试设计。

### Issues

#### Critical Issues (0)
无

#### High Issues (0)
无

#### Medium Issues (0)
无

#### Low Issues (3)
- **TCP引用补充** (Source Proposals): 已补充TCP-2026-001 Story Requirement T9引用
- **Prompt增强说明** (Title Generation Prompt): Story增加了风格多样性要求（悬念式、数字式、情感式、对比式、疑问式），超出TCP定义但为合理增强，有助于提高标题吸引力
- **去重优化** (T1 Tasks): TCP titles模块包含"去重优化"功能，建议在Prompt中添加"确保5个标题内容和风格各不相同"

### Recommendations
- 建议与E8.1话题生成合并为单次AI调用，减少API调用次数和成本
- 考虑添加"重新生成"按钮，让用户对不满意的标题重新生成
- 标题长度建议在UI上实时显示字数，帮助用户判断是否符合平台要求
- 可考虑添加标题风格标签（如"悬念式"、"数字式"），帮助用户理解不同风格

## QA Test Design Metadata

| Field | Value |
|-------|-------|
| test_design_level | Standard |
| complexity_indicators | 2 |
| security_sensitive | false |
| calculated_by | Architect (post-review) |
| calculation_date | 2026-01-14 |

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-14 | SM | Created → AwaitingArchReview | Story created from PCP-2026-001 |
| 2026-01-14 | Architect | AwaitingArchReview → AwaitingTestDesign | Score: 9.7/10, 0 critical / 0 major issues |
