# Story 4.3: 视频自动剪辑合成

## Status
Draft

## Story

**As a** 系统,
**I want** 根据脚本和配音自动剪辑合成视频,
**so that** 用户可以获得成品视频

## Acceptance Criteria

### AC1: 视频片段裁剪

**Scenario**
```gherkin
GIVEN 配音完成，获得各段时长
WHEN 系统裁剪视频
THEN
  - 根据脚本段落获取对应镜头
  - 按配音时长裁剪视频片段
  - 使用FFmpeg提取指定时间段
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-1.1 | 优先使用推荐镜头 |
| BR-1.2 | 片段时长=配音时长+0.5秒过渡 |
| BR-1.3 | 从视频中心位置开始裁剪 |

---

### AC2: 音视频合成

**Scenario**
```gherkin
GIVEN 视频片段和配音音频准备完成
WHEN 系统执行合成
THEN
  - 按顺序拼接视频片段
  - 叠加配音音轨
  - 输出竖屏格式（1080x1920）
  - 上传成品到OSS
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-2.1 | 输出格式: H.264, 4Mbps |
| BR-2.2 | 竖屏尺寸: 1080x1920 |
| BR-2.3 | 帧率: 30fps |

---

### AC3: 字幕烧录（可选）

**Scenario**
```gherkin
GIVEN 用户启用字幕功能
WHEN 合成视频时
THEN
  - 根据脚本生成时间轴对齐的字幕
  - 应用选择的字幕样式
  - 将字幕烧录到视频
```

**Business Rules**
| ID | Rule |
|----|------|
| BR-3.1 | 字幕位置：底部居中 |
| BR-3.2 | 5种预设样式可选 |

---

## Tasks / Subtasks

- [ ] **T1: FFmpeg视频裁剪** `[AC1]`
- [ ] **T2: FFmpeg音视频合成** `[AC2]`
- [ ] **T3: ASS字幕生成和烧录** `[AC3]`

## Dev Notes

### Provides APIs
- `GET /api/v1/tasks/{id}/output`

### Dependencies
- 依赖 Story 4.1 (TTS配音服务)

### Architecture Reference
[Source: docs/architecture.md - Section 4.5 Video Composition Pipeline]

---

## Change Log

| Date | Agent | Status Transition | Details/Link |
|------|-------|-------------------|--------------|
| 2026-01-22 | SM | Created → Draft | Story created from PRD Epic 4 |
